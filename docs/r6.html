<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.56">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Modesto">
<meta name="dcterms.date" content="2023-08-16">

<title>R6: Advanced data management – R for Biochemists @UAM</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/quarto-contrib/bootstrap-icons-1.9.1/all.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>


<link rel="stylesheet" href="styles.css">
<link rel="stylesheet" href="include/webex.css">
</head>

<body class="floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="./index.html" class="navbar-brand navbar-brand-logo">
    <img src="./r4biochemists.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">R for Biochemists <span class="citation" data-cites="UAM">@UAM</span></span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-course-contents" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Course Contents</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-course-contents">    
        <li>
    <a class="dropdown-item" href="./r1.html">
 <span class="dropdown-text">R1: Variables, Operators and data structures</span></a>
  </li>  
        <li class="dropdown-header">r2.qmd</li>
        <li class="dropdown-header">r3.qmd</li>
        <li class="dropdown-header">r4.qmd</li>
        <li>
    <a class="dropdown-item" href="./r5.html">
 <span class="dropdown-text">R5: Base plots in R</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./r6.html">
 <span class="dropdown-text">R6: Advanced data management</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./r7.html">
 <span class="dropdown-text">R7: Project management for reproducible research in R</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./r8.html">
 <span class="dropdown-text">R8: Plot your data in R - Episode II</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./r9.html">
 <span class="dropdown-text">R9: R for Molecular Biology</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
    <a href="https://github.com/r4biochemists/r4biochemists.github.io" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-github"></i></a>
    <a href="https://minhaskamal.github.io/DownGit/#/home?url=https://github.com/r4biochemists/r4biochemists.github.io/tree/main/data" title="Download Data" class="quarto-navigation-tool px-1" aria-label="Download Data"><i class="bi bi-cloud-download"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#transform-dataframes" id="toc-transform-dataframes" class="nav-link active" data-scroll-target="#transform-dataframes"><span class="header-section-number">1</span> Transform dataframes</a>
  <ul class="collapse">
  <li><a href="#sorting-and-subsetting-data" id="toc-sorting-and-subsetting-data" class="nav-link" data-scroll-target="#sorting-and-subsetting-data"><span class="header-section-number">1.1</span> Sorting and subsetting data</a></li>
  <li><a href="#combining-dataframes" id="toc-combining-dataframes" class="nav-link" data-scroll-target="#combining-dataframes"><span class="header-section-number">1.2</span> Combining dataframes</a>
  <ul class="collapse">
  <li><a href="#quick-exercise-i" id="toc-quick-exercise-i" class="nav-link" data-scroll-target="#quick-exercise-i"><span style="color:darkseagreen">Quick exercise (I)</span></a></li>
  </ul></li>
  <li><a href="#zebra" id="toc-zebra" class="nav-link" data-scroll-target="#zebra"><span class="header-section-number">1.3</span> Data matrix format (wide vs.&nbsp;long table)</a>
  <ul class="collapse">
  <li><a href="#quick-exercise-ii" id="toc-quick-exercise-ii" class="nav-link" data-scroll-target="#quick-exercise-ii"><span style="color:darkseagreen">Quick exercise (II)</span></a></li>
  </ul></li>
  </ul></li>
  <li><a href="#working-efficiently-with-large-datasets" id="toc-working-efficiently-with-large-datasets" class="nav-link" data-scroll-target="#working-efficiently-with-large-datasets"><span class="header-section-number">2</span> Working efficiently with large datasets</a>
  <ul class="collapse">
  <li><a href="#fast-loading-of-huge-datasets-and-creation-of-contingency-tables" id="toc-fast-loading-of-huge-datasets-and-creation-of-contingency-tables" class="nav-link" data-scroll-target="#fast-loading-of-huge-datasets-and-creation-of-contingency-tables"><span class="header-section-number">2.1</span> Fast loading of huge datasets and creation of contingency tables</a></li>
  <li><a href="#frequency-tables-table-vs.-xtabs" id="toc-frequency-tables-table-vs.-xtabs" class="nav-link" data-scroll-target="#frequency-tables-table-vs.-xtabs"><span class="header-section-number">2.2</span> Frequency tables: <code>table()</code> vs.&nbsp;<code>xtabs()</code></a>
  <ul class="collapse">
  <li><a href="#quick-exercise-iii" id="toc-quick-exercise-iii" class="nav-link" data-scroll-target="#quick-exercise-iii"><span style="color:darkseagreen">Quick exercise (III)</span></a></li>
  </ul></li>
  </ul></li>
  <li><a href="#data-aggregation-and-transformation" id="toc-data-aggregation-and-transformation" class="nav-link" data-scroll-target="#data-aggregation-and-transformation"><span class="header-section-number">3</span> Data aggregation and transformation</a>
  <ul class="collapse">
  <li><a href="#by-aggregate" id="toc-by-aggregate" class="nav-link" data-scroll-target="#by-aggregate"><span class="header-section-number">3.1</span> By() &amp; aggregate()</a>
  <ul class="collapse">
  <li><a href="#quick-exercise-iv" id="toc-quick-exercise-iv" class="nav-link" data-scroll-target="#quick-exercise-iv"><span style="color:darkseagreen">Quick exercise (IV)</span></a></li>
  </ul></li>
  <li><a href="#apply-family-of-functions" id="toc-apply-family-of-functions" class="nav-link" data-scroll-target="#apply-family-of-functions"><span class="header-section-number">3.2</span> Apply family of functions</a>
  <ul class="collapse">
  <li><a href="#quick-exercise-v" id="toc-quick-exercise-v" class="nav-link" data-scroll-target="#quick-exercise-v"><span style="color:darkseagreen">Quick exercise (V)</span></a></li>
  </ul></li>
  </ul></li>
  <li><a href="#sec-references" id="toc-sec-references" class="nav-link" data-scroll-target="#sec-references"><span class="header-section-number">4</span> References</a></li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises"><span class="header-section-number">5</span> <span style="color:green">Exercises</span></a></li>
  <li><a href="#extra-exercises" id="toc-extra-exercises" class="nav-link" data-scroll-target="#extra-exercises"><span class="header-section-number">6</span> <span style="color:green">Extra exercises</span></a></li>
  <li><a href="#session-info" id="toc-session-info" class="nav-link" data-scroll-target="#session-info"><span class="header-section-number">7</span> Session Info</a></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content column-page-right" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">R6: Advanced data management</h1>
  <div class="quarto-categories">
    <div class="quarto-category">Data management</div>
    <div class="quarto-category">Data transformation</div>
    <div class="quarto-category">tabulation</div>
    <div class="quarto-category">aggregation</div>
    <div class="quarto-category">Large datasets</div>
    <div class="quarto-category">apply</div>
  </div>
  </div>



<div class="quarto-title-meta column-page-right">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Modesto </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">August 16, 2023</p>
    </div>
  </div>
  
    <div>
    <div class="quarto-title-meta-heading">Modified</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">October 31, 2024</p>
    </div>
  </div>
    
  </div>
  


</header>


<section id="transform-dataframes" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Transform dataframes</h1>
<p>When you want to explore, present, analyze, or transform your data, you often need to subdivide, aggregate, or sort a vector or data frame by one or more variables. Currently, the R universe is essentially built on two (seemingly contradictory) approaches: Base R and <code>tidyverse</code> libraries (<code>dplyr()</code> &amp; <code>tidyr()</code>) Although these two approaches are often seen as two different philosophies, they are meant to work together (see ref. 8 <a href="#sec-references">below</a>).</p>
<p>We suggest some examples and tricks from Base R in this lesson because we believe that learning to work with Base R provides a broader range of capabilities for different types of data and work environments.</p>
<section id="sorting-and-subsetting-data" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="sorting-and-subsetting-data"><span class="header-section-number">1.1</span> Sorting and subsetting data</h2>
<p>How come? Numeric? Alphabetic? increasing or decreasing order?</p>
<p>There are two main functions in R to order your data, <code>sort()</code> and <code>order()</code>. Let’s see an example using the file <a href="data/coli_genomes_renamed.csv"><em>coli_genomes_renamed.csv</em></a>, that we used in the lesson <a href="r3.html#save">R3</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#load the dataset</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>coli_genomes <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="at">file =</span> <span class="st">"data/coli_genomes_renamed.csv"</span>, <span class="at">strip.white =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co">#test sort() &amp; order() in a vector</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">order</span>(coli_genomes<span class="sc">$</span>Year)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 15  7  8  6  3  2  5 14 16 17 18 20 22  9 10 11 12 13 19 21  1  4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sort</span>(coli_genomes<span class="sc">$</span>Year)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 2005 2006 2006 2007 2008 2010 2011 2011 2012 2012 2012 2012 2012 2013 2013
[16] 2013 2013 2013 2015 2016</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sort</span>(coli_genomes<span class="sc">$</span>Year, <span class="at">decreasing=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 2016 2015 2013 2013 2013 2013 2013 2012 2012 2012 2012 2012 2011 2011 2010
[16] 2008 2007 2006 2006 2005</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">order</span>(coli_genomes<span class="sc">$</span>Phylogroup)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1]  4  5  6  7  8 12 13 18 20 21  3 14 22  2 15 16 17 19  1  9 10 11</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sort</span>(coli_genomes<span class="sc">$</span>Phylogroup)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "A"  "A"  "A"  "A"  "A"  "A"  "A"  "A"  "A"  "A"  "B1" "B1" "B1" "C"  "C" 
[16] "C"  "C"  "C"  "D"  "D"  "D"  "D" </code></pre>
</div>
</div>
<p>As you noticed, the R function <code>order()</code> returns a permutation of the order of the elements of a vector. The output is an index vector, not the vector itself. Also note that if the vector contains any NA values, they will be at the end of the index vector by default.</p>
<p>On the other hand, the function <code>sort()</code> returns returns the vector you pass as input sorted in ascending order by default.</p>
<p>Both functions order the data increasingly, and can be used for numeric or string variables. If you set the <code>decreasing</code> argument to <code>TRUE</code> in a <code>sort()</code> or <code>order()</code>, you will geet the vector of indices in descending order.</p>
<p>You can also use these functions to order a data frame according to a vector. Alternatively, you can also arrange or <em>shuffle</em> a data frame in reverse order.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">#order the dataframe by one column, sort or order?</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>coli_genomes[<span class="fu">order</span>(coli_genomes<span class="sc">$</span>Year),]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    Strain    Biosample Year  Source Phylogroup Serotype  Clonotype
15 LREC255 SAMN14278630 2005   Avian          C  O78:H19     CH4-27
7  LREC244 SAMN14278619 2006 Porcine          A   O2:H32    CH11-23
8  LREC245 SAMN14278620 2006 Porcine          A  ONT:H45    C11-398
6  LREC243 SAMN14278618 2007 Porcine          A   O9:H37     CH7-31
3  LREC240 SAMN14278615 2008   Human         B1  O76:H30    CH29-38
2  LREC239 SAMN14278614 2010   Human          C O153:H19     CH4-25
5  LREC242 SAMN14278617 2011 Porcine          A  ONT:HNM     CH7-54
14 LREC254 SAMN14278629 2011   Avian         B1 O142:H30     C41-35
16 LREC256 SAMN14278631 2012   Human          C   O8:H19     CH4-54
17 LREC257 SAMN14278632 2012   Human          C   O9:H19     CH4-27
18 LREC258 SAMN14278633 2012   Human          A    O9:H4     CH7-34
20 LREC260 SAMN14278635 2012   Human          A  ONT:H33    CH11-54
22 LREC262 SAMN14278637 2012   Human         B1  O66:H10     CH4-32
9  LREC249 SAMN14278624 2013   Human          D O145:H28   CH23-331
10 LREC250 SAMN14278625 2013   Human          D O145:H28   CH23-331
11 LREC251 SAMN14278626 2013   Human          D O145:H28   CH23-331
12 LREC252 SAMN14278627 2013   Human          A  ONT:H37     C11-54
13 LREC253 SAMN14278628 2013   Avian          A  ONT:H19    CH94-23
19 LREC259 SAMN14278634 2015   Human          C   O9:H19 CH4like-27
21 LREC261 SAMN14278636 2016   Human          A  O98:H26    CH27-23
1  LREC237 SAMN14278613   NA   Human          D  ONT:H28   CH23-331
4  LREC241 SAMN14278616   NA   Human          A  O78:H11    CH11-41
   Sequence.Type VF Plasmids kmer Contigs    N50 longest.contig..bp.
15          ST88 11        4  113     108 405376             1190696
7           ST10  4        7  115     277  89185              281444
8        ST10888  2        7  115     203  94368              280268
6         ST3011  7        3   93     158 106897              369508
3          ST156 10        2   89     114 270767              738861
2           ST88 14        3  117     159 323172              760527
5          ST746  5        9   89     320  45936              128053
14         ST359  9        4  113     102 240847              460510
16          ST88 14        2  113     108 281822             1140163
17          ST88 14        4   91     224 140521              284241
18          ST46  8        4   85     204  86565              300086
20          ST10  2        5  117     120 228491              576949
22        ST1049  4        2  113      94 325747              822206
9           ST32 22        1  115     376 200150              424527
10         ST137 22        3  111     205 281589              617142
11          ST32 20        1  113     206 182651              412836
12          ST48  1        0  113     140 105396              272304
13         ST347  2        0  117     134 110661              497785
19       ST10890 13        3  113     171 326962              749412
21        ST8233  2        4   89     114 187945              537848
1          ST524 18        3  117     223 272287              662555
4           ST48  5        3  117     212 112160              285056
   Assembly_length contigs1kb average_contig
15         5196698         38       48117.57
7          5406295        155       19517.31
8          4796593        114       23628.54
6          4638334         93       29356.54
3          4875343         47       42766.17
2          5415613         57       34060.46
5          4858138        212       15181.68
14         4992565         42       48946.72
16         5252065         43       48630.23
17         5085107        110       22701.37
18         4915667        121       24096.41
20         4881205         48       40676.71
22         4839344         32       51482.38
9          5389075        131       14332.65
10         5340478         78       26051.11
11         5276782         95       25615.45
12         4507328         78       32195.20
13         4664768         77       34811.70
19         5200701         77       30413.46
21         4821342         53       42292.47
1          5341632         74       23953.51
4          5167401        101       24374.53</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>coli_genomes[<span class="fu">sort</span>(coli_genomes<span class="sc">$</span>Year),] <span class="co">#what happened?</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      Strain Biosample Year Source Phylogroup Serotype Clonotype Sequence.Type
NA      &lt;NA&gt;      &lt;NA&gt;   NA   &lt;NA&gt;       &lt;NA&gt;     &lt;NA&gt;      &lt;NA&gt;          &lt;NA&gt;
NA.1    &lt;NA&gt;      &lt;NA&gt;   NA   &lt;NA&gt;       &lt;NA&gt;     &lt;NA&gt;      &lt;NA&gt;          &lt;NA&gt;
NA.2    &lt;NA&gt;      &lt;NA&gt;   NA   &lt;NA&gt;       &lt;NA&gt;     &lt;NA&gt;      &lt;NA&gt;          &lt;NA&gt;
NA.3    &lt;NA&gt;      &lt;NA&gt;   NA   &lt;NA&gt;       &lt;NA&gt;     &lt;NA&gt;      &lt;NA&gt;          &lt;NA&gt;
NA.4    &lt;NA&gt;      &lt;NA&gt;   NA   &lt;NA&gt;       &lt;NA&gt;     &lt;NA&gt;      &lt;NA&gt;          &lt;NA&gt;
NA.5    &lt;NA&gt;      &lt;NA&gt;   NA   &lt;NA&gt;       &lt;NA&gt;     &lt;NA&gt;      &lt;NA&gt;          &lt;NA&gt;
NA.6    &lt;NA&gt;      &lt;NA&gt;   NA   &lt;NA&gt;       &lt;NA&gt;     &lt;NA&gt;      &lt;NA&gt;          &lt;NA&gt;
NA.7    &lt;NA&gt;      &lt;NA&gt;   NA   &lt;NA&gt;       &lt;NA&gt;     &lt;NA&gt;      &lt;NA&gt;          &lt;NA&gt;
NA.8    &lt;NA&gt;      &lt;NA&gt;   NA   &lt;NA&gt;       &lt;NA&gt;     &lt;NA&gt;      &lt;NA&gt;          &lt;NA&gt;
NA.9    &lt;NA&gt;      &lt;NA&gt;   NA   &lt;NA&gt;       &lt;NA&gt;     &lt;NA&gt;      &lt;NA&gt;          &lt;NA&gt;
NA.10   &lt;NA&gt;      &lt;NA&gt;   NA   &lt;NA&gt;       &lt;NA&gt;     &lt;NA&gt;      &lt;NA&gt;          &lt;NA&gt;
NA.11   &lt;NA&gt;      &lt;NA&gt;   NA   &lt;NA&gt;       &lt;NA&gt;     &lt;NA&gt;      &lt;NA&gt;          &lt;NA&gt;
NA.12   &lt;NA&gt;      &lt;NA&gt;   NA   &lt;NA&gt;       &lt;NA&gt;     &lt;NA&gt;      &lt;NA&gt;          &lt;NA&gt;
NA.13   &lt;NA&gt;      &lt;NA&gt;   NA   &lt;NA&gt;       &lt;NA&gt;     &lt;NA&gt;      &lt;NA&gt;          &lt;NA&gt;
NA.14   &lt;NA&gt;      &lt;NA&gt;   NA   &lt;NA&gt;       &lt;NA&gt;     &lt;NA&gt;      &lt;NA&gt;          &lt;NA&gt;
NA.15   &lt;NA&gt;      &lt;NA&gt;   NA   &lt;NA&gt;       &lt;NA&gt;     &lt;NA&gt;      &lt;NA&gt;          &lt;NA&gt;
NA.16   &lt;NA&gt;      &lt;NA&gt;   NA   &lt;NA&gt;       &lt;NA&gt;     &lt;NA&gt;      &lt;NA&gt;          &lt;NA&gt;
NA.17   &lt;NA&gt;      &lt;NA&gt;   NA   &lt;NA&gt;       &lt;NA&gt;     &lt;NA&gt;      &lt;NA&gt;          &lt;NA&gt;
NA.18   &lt;NA&gt;      &lt;NA&gt;   NA   &lt;NA&gt;       &lt;NA&gt;     &lt;NA&gt;      &lt;NA&gt;          &lt;NA&gt;
NA.19   &lt;NA&gt;      &lt;NA&gt;   NA   &lt;NA&gt;       &lt;NA&gt;     &lt;NA&gt;      &lt;NA&gt;          &lt;NA&gt;
      VF Plasmids kmer Contigs N50 longest.contig..bp. Assembly_length
NA    NA       NA   NA      NA  NA                  NA              NA
NA.1  NA       NA   NA      NA  NA                  NA              NA
NA.2  NA       NA   NA      NA  NA                  NA              NA
NA.3  NA       NA   NA      NA  NA                  NA              NA
NA.4  NA       NA   NA      NA  NA                  NA              NA
NA.5  NA       NA   NA      NA  NA                  NA              NA
NA.6  NA       NA   NA      NA  NA                  NA              NA
NA.7  NA       NA   NA      NA  NA                  NA              NA
NA.8  NA       NA   NA      NA  NA                  NA              NA
NA.9  NA       NA   NA      NA  NA                  NA              NA
NA.10 NA       NA   NA      NA  NA                  NA              NA
NA.11 NA       NA   NA      NA  NA                  NA              NA
NA.12 NA       NA   NA      NA  NA                  NA              NA
NA.13 NA       NA   NA      NA  NA                  NA              NA
NA.14 NA       NA   NA      NA  NA                  NA              NA
NA.15 NA       NA   NA      NA  NA                  NA              NA
NA.16 NA       NA   NA      NA  NA                  NA              NA
NA.17 NA       NA   NA      NA  NA                  NA              NA
NA.18 NA       NA   NA      NA  NA                  NA              NA
NA.19 NA       NA   NA      NA  NA                  NA              NA
      contigs1kb average_contig
NA            NA             NA
NA.1          NA             NA
NA.2          NA             NA
NA.3          NA             NA
NA.4          NA             NA
NA.5          NA             NA
NA.6          NA             NA
NA.7          NA             NA
NA.8          NA             NA
NA.9          NA             NA
NA.10         NA             NA
NA.11         NA             NA
NA.12         NA             NA
NA.13         NA             NA
NA.14         NA             NA
NA.15         NA             NA
NA.16         NA             NA
NA.17         NA             NA
NA.18         NA             NA
NA.19         NA             NA</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Random order of rows with sample </span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>coli_genomes[<span class="fu">sample</span>(<span class="fu">nrow</span>(coli_genomes), <span class="at">replace =</span> <span class="cn">FALSE</span>), ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    Strain    Biosample Year  Source Phylogroup Serotype  Clonotype
4  LREC241 SAMN14278616   NA   Human          A  O78:H11    CH11-41
9  LREC249 SAMN14278624 2013   Human          D O145:H28   CH23-331
13 LREC253 SAMN14278628 2013   Avian          A  ONT:H19    CH94-23
3  LREC240 SAMN14278615 2008   Human         B1  O76:H30    CH29-38
22 LREC262 SAMN14278637 2012   Human         B1  O66:H10     CH4-32
12 LREC252 SAMN14278627 2013   Human          A  ONT:H37     C11-54
17 LREC257 SAMN14278632 2012   Human          C   O9:H19     CH4-27
14 LREC254 SAMN14278629 2011   Avian         B1 O142:H30     C41-35
19 LREC259 SAMN14278634 2015   Human          C   O9:H19 CH4like-27
6  LREC243 SAMN14278618 2007 Porcine          A   O9:H37     CH7-31
5  LREC242 SAMN14278617 2011 Porcine          A  ONT:HNM     CH7-54
7  LREC244 SAMN14278619 2006 Porcine          A   O2:H32    CH11-23
21 LREC261 SAMN14278636 2016   Human          A  O98:H26    CH27-23
8  LREC245 SAMN14278620 2006 Porcine          A  ONT:H45    C11-398
1  LREC237 SAMN14278613   NA   Human          D  ONT:H28   CH23-331
18 LREC258 SAMN14278633 2012   Human          A    O9:H4     CH7-34
2  LREC239 SAMN14278614 2010   Human          C O153:H19     CH4-25
15 LREC255 SAMN14278630 2005   Avian          C  O78:H19     CH4-27
10 LREC250 SAMN14278625 2013   Human          D O145:H28   CH23-331
16 LREC256 SAMN14278631 2012   Human          C   O8:H19     CH4-54
11 LREC251 SAMN14278626 2013   Human          D O145:H28   CH23-331
20 LREC260 SAMN14278635 2012   Human          A  ONT:H33    CH11-54
   Sequence.Type VF Plasmids kmer Contigs    N50 longest.contig..bp.
4           ST48  5        3  117     212 112160              285056
9           ST32 22        1  115     376 200150              424527
13         ST347  2        0  117     134 110661              497785
3          ST156 10        2   89     114 270767              738861
22        ST1049  4        2  113      94 325747              822206
12          ST48  1        0  113     140 105396              272304
17          ST88 14        4   91     224 140521              284241
14         ST359  9        4  113     102 240847              460510
19       ST10890 13        3  113     171 326962              749412
6         ST3011  7        3   93     158 106897              369508
5          ST746  5        9   89     320  45936              128053
7           ST10  4        7  115     277  89185              281444
21        ST8233  2        4   89     114 187945              537848
8        ST10888  2        7  115     203  94368              280268
1          ST524 18        3  117     223 272287              662555
18          ST46  8        4   85     204  86565              300086
2           ST88 14        3  117     159 323172              760527
15          ST88 11        4  113     108 405376             1190696
10         ST137 22        3  111     205 281589              617142
16          ST88 14        2  113     108 281822             1140163
11          ST32 20        1  113     206 182651              412836
20          ST10  2        5  117     120 228491              576949
   Assembly_length contigs1kb average_contig
4          5167401        101       24374.53
9          5389075        131       14332.65
13         4664768         77       34811.70
3          4875343         47       42766.17
22         4839344         32       51482.38
12         4507328         78       32195.20
17         5085107        110       22701.37
14         4992565         42       48946.72
19         5200701         77       30413.46
6          4638334         93       29356.54
5          4858138        212       15181.68
7          5406295        155       19517.31
21         4821342         53       42292.47
8          4796593        114       23628.54
1          5341632         74       23953.51
18         4915667        121       24096.41
2          5415613         57       34060.46
15         5196698         38       48117.57
10         5340478         78       26051.11
16         5252065         43       48630.23
11         5276782         95       25615.45
20         4881205         48       40676.71</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Reverse order of rows</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>coli_genomes[<span class="fu">nrow</span>(coli_genomes)<span class="sc">:</span><span class="dv">1</span>, ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    Strain    Biosample Year  Source Phylogroup Serotype  Clonotype
22 LREC262 SAMN14278637 2012   Human         B1  O66:H10     CH4-32
21 LREC261 SAMN14278636 2016   Human          A  O98:H26    CH27-23
20 LREC260 SAMN14278635 2012   Human          A  ONT:H33    CH11-54
19 LREC259 SAMN14278634 2015   Human          C   O9:H19 CH4like-27
18 LREC258 SAMN14278633 2012   Human          A    O9:H4     CH7-34
17 LREC257 SAMN14278632 2012   Human          C   O9:H19     CH4-27
16 LREC256 SAMN14278631 2012   Human          C   O8:H19     CH4-54
15 LREC255 SAMN14278630 2005   Avian          C  O78:H19     CH4-27
14 LREC254 SAMN14278629 2011   Avian         B1 O142:H30     C41-35
13 LREC253 SAMN14278628 2013   Avian          A  ONT:H19    CH94-23
12 LREC252 SAMN14278627 2013   Human          A  ONT:H37     C11-54
11 LREC251 SAMN14278626 2013   Human          D O145:H28   CH23-331
10 LREC250 SAMN14278625 2013   Human          D O145:H28   CH23-331
9  LREC249 SAMN14278624 2013   Human          D O145:H28   CH23-331
8  LREC245 SAMN14278620 2006 Porcine          A  ONT:H45    C11-398
7  LREC244 SAMN14278619 2006 Porcine          A   O2:H32    CH11-23
6  LREC243 SAMN14278618 2007 Porcine          A   O9:H37     CH7-31
5  LREC242 SAMN14278617 2011 Porcine          A  ONT:HNM     CH7-54
4  LREC241 SAMN14278616   NA   Human          A  O78:H11    CH11-41
3  LREC240 SAMN14278615 2008   Human         B1  O76:H30    CH29-38
2  LREC239 SAMN14278614 2010   Human          C O153:H19     CH4-25
1  LREC237 SAMN14278613   NA   Human          D  ONT:H28   CH23-331
   Sequence.Type VF Plasmids kmer Contigs    N50 longest.contig..bp.
22        ST1049  4        2  113      94 325747              822206
21        ST8233  2        4   89     114 187945              537848
20          ST10  2        5  117     120 228491              576949
19       ST10890 13        3  113     171 326962              749412
18          ST46  8        4   85     204  86565              300086
17          ST88 14        4   91     224 140521              284241
16          ST88 14        2  113     108 281822             1140163
15          ST88 11        4  113     108 405376             1190696
14         ST359  9        4  113     102 240847              460510
13         ST347  2        0  117     134 110661              497785
12          ST48  1        0  113     140 105396              272304
11          ST32 20        1  113     206 182651              412836
10         ST137 22        3  111     205 281589              617142
9           ST32 22        1  115     376 200150              424527
8        ST10888  2        7  115     203  94368              280268
7           ST10  4        7  115     277  89185              281444
6         ST3011  7        3   93     158 106897              369508
5          ST746  5        9   89     320  45936              128053
4           ST48  5        3  117     212 112160              285056
3          ST156 10        2   89     114 270767              738861
2           ST88 14        3  117     159 323172              760527
1          ST524 18        3  117     223 272287              662555
   Assembly_length contigs1kb average_contig
22         4839344         32       51482.38
21         4821342         53       42292.47
20         4881205         48       40676.71
19         5200701         77       30413.46
18         4915667        121       24096.41
17         5085107        110       22701.37
16         5252065         43       48630.23
15         5196698         38       48117.57
14         4992565         42       48946.72
13         4664768         77       34811.70
12         4507328         78       32195.20
11         5276782         95       25615.45
10         5340478         78       26051.11
9          5389075        131       14332.65
8          4796593        114       23628.54
7          5406295        155       19517.31
6          4638334         93       29356.54
5          4858138        212       15181.68
4          5167401        101       24374.53
3          4875343         47       42766.17
2          5415613         57       34060.46
1          5341632         74       23953.51</code></pre>
</div>
</div>
<p>Now imagine you have a large data set and want to subdivide only some cases (=rows). You already know some ways to do this, but in the following example we will test the function ‘subset()’, which is very handy when you want to extract the cases that satisfy multiple conditions.</p>
<p>Imagine that for a new project we want to select the strains with better genome design quality or from a subset. We will keep strains from Phylogroup A, with an assembly N50 &gt; 150,000 bp and less than 100 contigs &gt;= 1 kb.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co">#option 1: multi-step</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>selection<span class="ot">&lt;-</span>coli_genomes[coli_genomes<span class="sc">$</span>contigs1kb<span class="sc">&lt;</span><span class="dv">100</span>,]</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>selection<span class="ot">&lt;-</span>selection[selection<span class="sc">$</span>N50<span class="sc">&gt;</span><span class="dv">150000</span>,]</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>selection<span class="ot">&lt;-</span>selection[selection<span class="sc">$</span>Phylogroup<span class="sc">==</span><span class="st">'A'</span>,]</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="co">#option 2:  which statements </span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>selection2<span class="ot">&lt;-</span>coli_genomes[<span class="fu">which</span>(coli_genomes<span class="sc">$</span>contigs1kb<span class="sc">&lt;</span><span class="dv">100</span> <span class="sc">&amp;</span> coli_genomes<span class="sc">$</span>N50<span class="sc">&gt;</span><span class="dv">150000</span> <span class="sc">&amp;</span> coli_genomes<span class="sc">$</span>Phylogroup<span class="sc">==</span><span class="st">'A'</span>),]</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="co">#option 2b:with attach(dataframe) you avoid repeat the name of the dataframe</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="fu">attach</span>(coli_genomes)</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>selection2 <span class="ot">&lt;-</span> coli_genomes[<span class="fu">which</span>(contigs1kb<span class="sc">&lt;</span><span class="dv">100</span> <span class="sc">&amp;</span> N50<span class="sc">&gt;</span><span class="dv">150000</span> <span class="sc">&amp;</span> Phylogroup<span class="sc">==</span><span class="st">'A'</span>),]</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a><span class="fu">detach</span>(coli_genomes) <span class="co">#detach dataframe</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a><span class="co">#option 3: subset() is a straightforward way to do that trick </span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>selection3<span class="ot">&lt;-</span><span class="fu">subset</span>(coli_genomes, <span class="at">subset=</span> contigs1kb<span class="sc">&lt;</span><span class="dv">100</span> <span class="sc">&amp;</span> N50<span class="sc">&gt;</span><span class="dv">150000</span> <span class="sc">&amp;</span> Phylogroup<span class="sc">==</span><span class="st">'A'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If you want to make sure that the three methods give the same output, you can check the data frame, or check the dimensions or structure with <code>dim()</code> or <code>str()</code>, but this is difficult with large data sets with hundreds or thousands of cases (see below). The function <code>all.equal()</code> does this task for you.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Are they the same?</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">all.equal</span>(selection,selection2) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">all.equal</span>(selection,selection3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
</section>
<section id="combining-dataframes" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="combining-dataframes"><span class="header-section-number">1.2</span> Combining dataframes</h2>
<p>If you work with a lot of data or get different batches of related data frames, you may have multiple tables and want to combine them in different ways. An easy way is to use <code>cbind()</code> or <code>rbind()</code> if you have the same number of rows and columns. A more practical way is to use the <code>merge()</code> function. Look and test the following examples using the <em>coli_genomes</em> data frame and a new table named <em>colis3.csv</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>colis <span class="ot">&lt;-</span> <span class="fu">read.csv2</span>(<span class="at">file =</span> <span class="st">'data/colis3.csv'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in file(file, "rt"): cannot open file 'data/colis3.csv': No such file
or directory</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error in file(file, "rt"): cannot open the connection</code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co">#rbind() and cbind()</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rbind</span>(coli_genomes,colis) <span class="co">#did it work? why??</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error: object 'colis' not found</code></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>(coli_genomes, colis) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error: object 'colis' not found</code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co">#merge()</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>merge<span class="ot">&lt;-</span><span class="fu">merge</span>(coli_genomes,colis) <span class="co">#inner join</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error: object 'colis' not found</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(merge)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>function (x, y, ...)  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>merge1<span class="ot">&lt;-</span><span class="fu">merge</span>(coli_genomes,colis, <span class="at">by=</span><span class="st">"Strain"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error: object 'colis' not found</code></pre>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(merge1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error: object 'merge1' not found</code></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>merge2<span class="ot">&lt;-</span><span class="fu">merge</span>(coli_genomes,colis, <span class="at">by=</span><span class="st">"Year"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error: object 'colis' not found</code></pre>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(merge2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error: object 'merge2' not found</code></pre>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>merge3<span class="ot">&lt;-</span><span class="fu">merge</span>(coli_genomes,colis, <span class="at">by=</span><span class="fu">c</span>(<span class="st">"Strain"</span>,<span class="st">"Year"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error: object 'colis' not found</code></pre>
</div>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(merge3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error: object 'merge3' not found</code></pre>
</div>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>merge4<span class="ot">&lt;-</span><span class="fu">merge</span>(coli_genomes,colis, <span class="at">all=</span><span class="cn">TRUE</span>) <span class="co">#outer join</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error: object 'colis' not found</code></pre>
</div>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(merge4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error: object 'merge4' not found</code></pre>
</div>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>merge5<span class="ot">&lt;-</span><span class="fu">merge</span>(coli_genomes,colis, <span class="at">all.x=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error: object 'colis' not found</code></pre>
</div>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(merge5)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error: object 'merge5' not found</code></pre>
</div>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>merge6<span class="ot">&lt;-</span><span class="fu">merge</span>(coli_genomes,colis, <span class="at">all.y=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error: object 'colis' not found</code></pre>
</div>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(merge6)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error: object 'merge6' not found</code></pre>
</div>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>merge7<span class="ot">&lt;-</span><span class="fu">merge</span>(coli_genomes,colis, <span class="at">by=</span><span class="cn">NULL</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error: object 'colis' not found</code></pre>
</div>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(merge7)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error: object 'merge7' not found</code></pre>
</div>
</div>
<p>As you noticed, the function <code>merge()</code> combines dataframes, however it is a generic function that can be also used with other objects (like vectors or matrices), but they will be coerced to <code>data.frame</code> class.</p>
<p>By default, <code>merge()</code> will do a <em>natural join</em> or <em>inner join</em>, merging two dataframes in one that contains only once the common elements of both. The arguments <code>all=TRUE</code>, <code>all.x=TRUE</code> and <code>all.y=TRUE</code> will force an <em>outer</em> join in which all elements of both, the first or the second dataframes are selected. In these cases, if not all rows in the first data frame match all the rows in the second, the output is filled with <code>NA</code> values in those cases.</p>
<p>Finally, the Cartesian product of both dataframes can be obtained in R setting as <code>NULL</code> the argument <code>by</code> of the <code>merge()</code> function.</p>
<section id="quick-exercise-i" class="level3">
<h3 class="anchored" data-anchor-id="quick-exercise-i"><span style="color:darkseagreen">Quick exercise (I)</span></h3>
<p>Two students enrolled in different University courses: Rafa in A, B, D, E and G and Roger in B, C, D and F. Rafa got the following marks 8, 9, 9.5, 8.75 and 9 and Roger obtained 10, 9.7, 9 and 10. Write a R program to create merged dataframes with all the marks (outer join), all the Rafa’s marks (left outer), all the Roger’s marks (right outer), and the marks in the common courses (inner join).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Create the dataframes</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>rafa <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">c</span>(<span class="st">"A"</span>,<span class="st">"B"</span>,<span class="st">"D"</span>,<span class="st">"E"</span>,<span class="st">"G"</span>),<span class="fu">c</span>(<span class="dv">8</span>,<span class="dv">9</span>,<span class="fl">9.5</span>,<span class="fl">8.75</span>,<span class="fl">9.5</span>))</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>roger <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">c</span>(<span class="st">"B"</span>,<span class="st">"C"</span>,<span class="st">"D"</span>,<span class="st">"F"</span>),<span class="fu">c</span>(<span class="dv">10</span>,<span class="fl">9.7</span>,<span class="dv">9</span>,<span class="dv">10</span>))</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(rafa) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Course"</span>,<span class="st">"Rafa"</span>)</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(roger) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Course"</span>,<span class="st">"Roger"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<strong>How would you obtain a table containing the marks of both students only for their common courses?</strong>
<div id="radio_VNBNXWNGPF" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_VNBNXWNGPF" value=""> <span>merge(rafa, roger, by = “Student”)</span></label><label><input type="radio" autocomplete="off" name="radio_VNBNXWNGPF" value="answer"> <span>merge(rafa, roger, by = “Course”)</span></label><label><input type="radio" autocomplete="off" name="radio_VNBNXWNGPF" value="answer"> <span>merge(rafa, roger)</span></label><label><input type="radio" autocomplete="off" name="radio_VNBNXWNGPF" value=""> <span>merge(rafa, roger, by = “Course”, all=TRUE)</span></label>
</div>
<strong>How would you obtain a table containing the marks of both students only for Rafa’s courses?</strong>
<div id="radio_TVATQONJUV" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_TVATQONJUV" value=""> <span>merge(rafa, roger, by = “Student”)</span></label><label><input type="radio" autocomplete="off" name="radio_TVATQONJUV" value=""> <span>merge(rafa, roger, all.y=TRUE)</span></label><label><input type="radio" autocomplete="off" name="radio_TVATQONJUV" value="answer"> <span>merge(rafa, roger, all.x=TRUE)</span></label><label><input type="radio" autocomplete="off" name="radio_TVATQONJUV" value=""> <span>merge(rafa, roger, by = “Course”, all=TRUE)</span></label>
</div>
</section>
</section>
<section id="zebra" class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="zebra"><span class="header-section-number">1.3</span> Data matrix format (wide vs.&nbsp;long table)</h2>
<div class="callout callout-style-default callout-important no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<i class="bi-question-circle " style="" role="img" aria-hidden="true"></i> How should I arrange my data table?
</div>
</div>
<div class="callout-body-container callout-body">
<p>A column per experimental condition or a column per variable? Is the same?</p>
</div>
</div>
<p>In the table <a href="data/Zebrafish_data.csv"><em>Zebrafish_data.csv</em></a> from the Lesson R5 we have the results of an experiment in which a collaborator scored the number of metastatic cancer cells upon the expression of different transcripts of the EFNA3 gene. Each transcript is cloned into a pLoC plasmid, and we have negative (empty plasmid) and positive controls (wt transcript). Let’s import and check the data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>ZFdata <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/Zebrafish_data.csv"</span>)</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(ZFdata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   41 obs. of  6 variables:
 $ pLoC : int  36 32 10 26 15 23 17 14 44 12 ...
 $ EFNA3: int  35 33 17 25 89 36 40 36 35 37 ...
 $ NC1  : int  58 26 26 18 20 24 10 31 28 26 ...
 $ NC1s : int  11 11 19 12 12 20 7 104 116 11 ...
 $ NC2  : int  53 37 56 48 27 29 22 79 22 18 ...
 $ NC2s : int  40 43 19 18 33 29 29 25 28 47 ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(ZFdata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  pLoC EFNA3 NC1 NC1s NC2 NC2s
1   36    35  58   11  53   40
2   32    33  26   11  37   43
3   10    17  26   19  56   19
4   26    25  18   12  48   18
5   15    89  20   12  27   33
6   23    36  24   20  29   29</code></pre>
</div>
</div>
<p>How many columns has the table? How many variables are there?</p>
<p>Here we have one column per experimental condition. Thus, this table format does not agree with the standard way to introduce the data in a table, the data-matrix: Rows for cases and columns for variables.</p>
<p>Having the data, we transform it in a datamatrix (aka <em>long</em> table) using the function <code>stack()</code>. You can also do it the other way around with the function <code>unstack().</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>ZF_stacked <span class="ot">&lt;-</span> <span class="fu">stack</span>(ZFdata)</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(ZF_stacked)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   246 obs. of  2 variables:
 $ values: int  36 32 10 26 15 23 17 14 44 12 ...
 $ ind   : Factor w/ 6 levels "pLoC","EFNA3",..: 1 1 1 1 1 1 1 1 1 1 ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(ZF_stacked)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  values  ind
1     36 pLoC
2     32 pLoC
3     10 pLoC
4     26 pLoC
5     15 pLoC
6     23 pLoC</code></pre>
</div>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>ZF_old <span class="ot">&lt;-</span> <span class="fu">unstack</span>(ZF_stacked)</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(ZF_old)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   41 obs. of  6 variables:
 $ pLoC : int  36 32 10 26 15 23 17 14 44 12 ...
 $ EFNA3: int  35 33 17 25 89 36 40 36 35 37 ...
 $ NC1  : int  58 26 26 18 20 24 10 31 28 26 ...
 $ NC1s : int  11 11 19 12 12 20 7 104 116 11 ...
 $ NC2  : int  53 37 56 48 27 29 22 79 22 18 ...
 $ NC2s : int  40 43 19 18 33 29 29 25 28 47 ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(ZF_old)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  pLoC EFNA3 NC1 NC1s NC2 NC2s
1   36    35  58   11  53   40
2   32    33  26   11  37   43
3   10    17  26   19  56   19
4   26    25  18   12  48   18
5   15    89  20   12  27   33
6   23    36  24   20  29   29</code></pre>
</div>
</div>
<p>However, some times the dataset is more complex and there are other variables that change the table structure, as in the table <a href="data/Zebrafish_full.csv"><em>Zebrafish_full.csv</em></a><em>.</em> In this case, remember that stack is designed to transform tables of only two variables. Thus, you must stack only the desired two variables and then final construct the table by adding the rest of the information, for instance with <code>cbind()</code>, as in the example below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>ZF_full <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/Zebrafish_full.csv"</span>, <span class="at">row.names=</span><span class="dv">1</span>)</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(ZF_full)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  pLoC EFNA3 NC1 NC1s NC2 NC2s assay
1   36    35  58   11  53   40     2
2   32    33  26   11  37   43     2
3   10    17  26   19  56   19     2
4   26    25  18   12  48   18     1
5   15    89  20   12  27   33     1
6   23    36  24   20  29   29     1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co">#option 1:</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="co">#step1: stack two main variables (sample &amp; number of cells)</span></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>ZF_full_some_stack <span class="ot">&lt;-</span> <span class="fu">stack</span>(ZF_full[,<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>])</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(ZF_full_some_stack,<span class="dv">15</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   values  ind
1      36 pLoC
2      32 pLoC
3      10 pLoC
4      26 pLoC
5      15 pLoC
6      23 pLoC
7      17 pLoC
8      14 pLoC
9      44 pLoC
10     12 pLoC
11      3 pLoC
12     21 pLoC
13     21 pLoC
14     39 pLoC
15     19 pLoC</code></pre>
</div>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co">#step2: reconstruct the table adding the third variable</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>ZF_full_stack <span class="ot">&lt;-</span> <span class="fu">cbind</span>(ZF_full_some_stack,ZF_full[,<span class="dv">7</span>])</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(ZF_full_stack) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Cells"</span>,<span class="st">"Sample"</span>,<span class="st">"Assay"</span>)</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(ZF_full_stack,<span class="dv">15</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Cells Sample Assay
1     36   pLoC     2
2     32   pLoC     2
3     10   pLoC     2
4     26   pLoC     1
5     15   pLoC     1
6     23   pLoC     1
7     17   pLoC     3
8     14   pLoC     2
9     44   pLoC     3
10    12   pLoC     1
11     3   pLoC     1
12    21   pLoC     1
13    21   pLoC     3
14    39   pLoC     2
15    19   pLoC     3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co">#option2: shorcut</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>ZF_full_stack2 <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="fu">stack</span>(ZF_full[,<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>]),ZF_full[,<span class="dv">7</span>])</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(ZF_full_stack2) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Cells"</span>,<span class="st">"Sample"</span>,<span class="st">"Assay"</span>)</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(ZF_full_stack2,<span class="dv">15</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Cells Sample Assay
1     36   pLoC     2
2     32   pLoC     2
3     10   pLoC     2
4     26   pLoC     1
5     15   pLoC     1
6     23   pLoC     1
7     17   pLoC     3
8     14   pLoC     2
9     44   pLoC     3
10    12   pLoC     1
11     3   pLoC     1
12    21   pLoC     1
13    21   pLoC     3
14    39   pLoC     2
15    19   pLoC     3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co">#the same result in both cases?</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a><span class="fu">all.equal</span>(ZF_full_stack,ZF_full_stack2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
<p>Remember that <strong><em>datamatrix</em></strong> is not an R structure, but a general concept in data analysis. Also, for more complex dataframes, I suggest to use the function <code>melt()</code>. However, this function name refers to two different functions in two alternative packages: <em>reshape2</em> and <em>data.table</em>, with slightly different behavior.</p>
<section id="quick-exercise-ii" class="level3">
<h3 class="anchored" data-anchor-id="quick-exercise-ii"><span style="color:darkseagreen">Quick exercise (II)</span></h3>
<p>From the previous exercise with marks of two students, we have a table <code>students</code> with all the marks, in which each student is a column.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>students <span class="ot">&lt;-</span>  <span class="fu">merge</span>(rafa, roger, <span class="at">by =</span> <span class="st">"Course"</span>, <span class="at">all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>students</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Course Rafa Roger
1      A 8.00    NA
2      B 9.00  10.0
3      C   NA   9.7
4      D 9.50   9.0
5      E 8.75    NA
6      F   NA  10.0
7      G 9.50    NA</code></pre>
</div>
</div>
<p>However, we need a table in which each column is a variable, as follows:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>   Course  Mark Student
1       A  8.00    Rafa
2       B  9.00    Rafa
3       C    NA    Rafa
4       D  9.50    Rafa
5       E  8.75    Rafa
6       F    NA    Rafa
7       G  9.50    Rafa
8       A    NA   Roger
9       B 10.00   Roger
10      C  9.70   Roger
11      D  9.00   Roger
12      E    NA   Roger
13      F 10.00   Roger
14      G    NA   Roger</code></pre>
</div>
</div>
<p>How would you obtain the second table?</p>
<div class="cell" data-webex.hide="See an answer">
<div class="webex-solution">
<button>
See an answer
</button>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="co">#1. Create the table</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>students2 <span class="ot">&lt;-</span> <span class="fu">cbind</span>(students[,<span class="dv">1</span>], <span class="fu">stack</span>(students[,<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>]))</span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Note that we have used stack() for only two columns and bind the output with the column 1 in the previous table</span></span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a><span class="co">#2. Rename variables</span></span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(students2) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Course"</span>,<span class="st">"Mark"</span>,<span class="st">"Student"</span>)</span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true" tabindex="-1"></a><span class="co">#3. Show table</span></span>
<span id="cb89-9"><a href="#cb89-9" aria-hidden="true" tabindex="-1"></a>students2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Course  Mark Student
1       A  8.00    Rafa
2       B  9.00    Rafa
3       C    NA    Rafa
4       D  9.50    Rafa
5       E  8.75    Rafa
6       F    NA    Rafa
7       G  9.50    Rafa
8       A    NA   Roger
9       B 10.00   Roger
10      C  9.70   Roger
11      D  9.00   Roger
12      E    NA   Roger
13      F 10.00   Roger
14      G    NA   Roger</code></pre>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="working-efficiently-with-large-datasets" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Working efficiently with large datasets</h1>
<section id="fast-loading-of-huge-datasets-and-creation-of-contingency-tables" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="fast-loading-of-huge-datasets-and-creation-of-contingency-tables"><span class="header-section-number">2.1</span> Fast loading of huge datasets and creation of contingency tables</h2>
<p>We are going to make some examples with a huge dataset of Covid19 Vaccination data in EU. The data is publicly available at <a href="https://www.ecdc.europa.eu/en/publications-data/data-covid-19-vaccination-eu-eea" class="uri">https://www.ecdc.europa.eu/en/publications-data/data-covid-19-vaccination-eu-eea</a>. While you can download and open a file from internet in R, in order to use the same dataset, we have a file <a href="../data/vaccines_EU_22oct2022.csv"><em>vaccines_EU_22oct2022.csv</em></a> in our data folder.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>From this point on, in some examples we will show only some lines of the output of the code chunks (you will notice that the output ends with <strong><em>— Cropped output —</em></strong>). Otherwise, this document is very long and difficult to follow.</p>
<p>As always, it’s encouraged to run the code yourself to see and understand the full returned output.</p>
</div>
</div>
<div class="cell" data-output.lines="[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20]">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="co">#open directly from the ECDC</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>vaccines <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="at">file =</span> <span class="st">"https://opendata.ecdc.europa.eu/covid19/vaccine_tracker/csv/data.csv"</span>, <span class="at">header=</span><span class="cn">TRUE</span>)</span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a><span class="co">#explore the data</span></span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(vaccines)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   813367 obs. of  18 variables:
 $ YearWeekISO        : chr  "2021-W02" "2023-W19" "2023-W19" "2023-W19" ...
 $ ReportingCountry   : chr  "AT" "AT" "AT" "AT" ...
 $ Denominator        : int  424628 431785 7427239 1551690 524214 741680 1086320 1392642 435176 3005708 ...
 $ NumberDosesReceived: int  0 0 0 0 0 0 0 0 0 0 ...
 $ NumberDosesExported: int  0 0 0 0 0 0 0 0 0 0 ...
 $ FirstDose          : int  0 0 1 0 0 0 0 0 0 0 ...
 $ FirstDoseRefused   : int  NA NA NA NA NA NA NA NA NA NA ...
 $ SecondDose         : int  0 0 0 0 0 0 0 0 0 0 ...
 $ DoseAdditional1    : int  0 0 1 0 0 0 0 0 0 1 ...
 $ DoseAdditional2    : int  0 0 9 0 1 1 3 1 0 3 ...
 $ DoseAdditional3    : int  0 0 13 0 3 4 2 3 0 1 ...
 $ DoseAdditional4    : int  0 0 0 0 0 0 0 0 0 0 ...
 $ DoseAdditional5    : int  0 0 0 0 0 0 0 0 0 0 ...
 $ UnknownDose        : int  0 0 0 0 0 0 0 0 0 0 ...
 $ Region             : chr  "AT" "AT" "AT" "AT" ...
 $ TargetGroup        : chr  "Age10_14" "Age0_4" "ALL" "Age&lt;18" ...
 $ Vaccine            : chr  "COMBA.4-5" "MODBA.1" "MOD" "MOD" ...
 $ Population         : int  8932664 8978929 8978929 8978929 8978929 8978929 8978929 8978929 8978929 8978929 ...
NA
--- Cropped output ---</code></pre>
</div>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(vaccines)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  YearWeekISO ReportingCountry Denominator NumberDosesReceived
1    2021-W02               AT      424628                   0
2    2023-W19               AT      431785                   0
3    2023-W19               AT     7427239                   0
4    2023-W19               AT     1551690                   0
5    2023-W19               AT      524214                   0
6    2023-W19               AT      741680                   0
  NumberDosesExported FirstDose FirstDoseRefused SecondDose DoseAdditional1
1                   0         0               NA          0               0
2                   0         0               NA          0               0
3                   0         1               NA          0               1
4                   0         0               NA          0               0
5                   0         0               NA          0               0
6                   0         0               NA          0               0
  DoseAdditional2 DoseAdditional3 DoseAdditional4 DoseAdditional5 UnknownDose
1               0               0               0               0           0
2               0               0               0               0           0
3               9              13               0               0           0
4               0               0               0               0           0
5               1               3               0               0           0
--- Cropped output ---</code></pre>
</div>
</div>
<p>Even with large datasets, we can use <code>table()</code> or <code>summary()</code> functions, to overview data. But, sometimes we just doesn’t.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(vaccines<span class="sc">$</span>Region)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
     AT      BE      BG      CY      CZ      DE      DK      EE      EL      ES 
  17292    7330    6001    7098    6593     564    4821    7755   16413   12960 
     FI    FI19   FI193   FI194   FI195   FI197    FI1B   FI1B1    FI1C   FI1C1 
  16965   16965   16965   16965   16965   16965   16965   16965   16965   16965 
  FI1C2   FI1C3   FI1C4   FI1C5    FI1D   FI1D1   FI1D2   FI1D3   FI1D5   FI1D7 
  16965   16965   16965   16965   16965   16965   16965   16965   16965   16965 
  FI1D8   FI1D9    FI20   FI200      FR     FR1     FRB     FRC     FRD     FRE 
  16965   16965   16965   16965    2394    1064    1064    1064    1064    1064 
    FRF     FRG     FRH     FRI     FRJ     FRK     FRL     FRM    FRY1    FRY2 
   1064    1064    1064    1064    1064    1064    1064    1064    1064    1064 
   FRY3    FRY4    FRY5      HR      HU      IE      IS      IT    ITC1    ITC2 
   1064    1064    1064    9270    6712    6367    5215    7119     570     347 
   ITC3    ITC4    ITF1    ITF2    ITF3    ITF4    ITF5    ITF6    ITG1    ITG2 
    486     503     436     337     492     449     393     419     468     389 
   ITH1    ITH2    ITH3    ITH4    ITH5    ITI1    ITI2    ITI3    ITI4      LI 
    399     419     486     445     507     437     449     451     506    5070 
     LT    LT01    LT02      LU      LV      MT      NL      NO      PL    PL21 
   8502    1308    1308   10476    5454    5964   14355    4467    9425    9425 
   PL22    PL41    PL42    PL43    PL51    PL52    PL61    PL62    PL63    PL71 
   9425    9425    9425    9425    9425    9425    9425    9425    9425    9425 
   PL72    PL81    PL82    PL84   PL92X      PT PTCSR01 PTCSR02 PTCSR03 PTCSR04 
   9425    9425    9425    9425    9425    8136     750     756     403     953 
PTCSR05 PTCSR06 PTCSR07      RO      SE    SE11    SE12    SE21    SE22    SE23 
   1092     278    1048    5867    4673     580     580     580     580     580 
   SE31    SE32    SE33      SI      SK     UNK 
    580     580     580    3131    3710    1197 </code></pre>
</div>
</div>
<div class="cell" data-output.lines="[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30]">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(vaccines<span class="sc">$</span>Region, vaccines<span class="sc">$</span>NumberDosesReceived)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         
              0     1     2     3     4     5     6     7     8     9    10
  AT      17072     0     0     0     0     0     0     0     0     0     0
  BE        129     0     0     0     0     0     0     0     0     0     0
  BG        423     0     0     0     0     0     0     0     0     0     0
  CY       6957     0     0     0     0     0     0     0     0     0     0
  CZ        649     0     0     0     0     0     0     0     0     0     0
  DE         21     0     0     0     0     0     0     0     0     0     0
  DK       4756     0     0     0     0     0     0     0     0     0     0
  EE       7603     0     0     0     0     0     0     0     0     0     0
  EL        866     0     0     0     0     0     0     0     0     0     0
  ES        478     0     0     0     0     0     0     0     0     0     0
  FI          0     0     0     0     0     0     0     0     0     0     0
  FI19        0     0     0     0     0     0     0     0     0     0     0
  FI193       0     0     0     0     0     0     0     0     0     0     0
  FI194       0     0     0     0     0     0     0     0     0     0     0
  FI195       0     0     0     0     0     0     0     0     0     0     0
  FI197       0     0     0     0     0     0     0     0     0     0     0
  FI1B        0     0     0     0     0     0     0     0     0     0     0
  FI1B1       0     0     0     0     0     0     0     0     0     0     0
  FI1C        0     0     0     0     0     0     0     0     0     0     0
  FI1C1       0     0     0     0     0     0     0     0     0     0     0
  FI1C2       0     0     0     0     0     0     0     0     0     0     0
  FI1C3       0     0     0     0     0     0     0     0     0     0     0
  FI1C4       0     0     0     0     0     0     0     0     0     0     0
  FI1C5       0     0     0     0     0     0     0     0     0     0     0
  FI1D        0     0     0     0     0     0     0     0     0     0     0
  FI1D1       0     0     0     0     0     0     0     0     0     0     0
  FI1D2       0     0     0     0     0     0     0     0     0     0     0
  FI1D3       0     0     0     0     0     0     0     0     0     0     0
--- Cropped output ---</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(vaccines[<span class="fu">which</span>(vaccines<span class="sc">$</span>Region<span class="sc">==</span><span class="st">"ES"</span>),][,<span class="dv">6</span>]) <span class="co">#see the data from Spain</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
      0       0       0    6581       2 1512566 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(vaccines)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in table(vaccines): attempt to make a table with &gt;= 2^31 elements</code></pre>
</div>
</div>
<p>When exploring (very) large datasets as in the example above you can find that some functions don’t work because they can’t handle all that data (<em>Error in table(vaccines) : attempt to make a table with &gt;= 2^31 elements</em>). Here, we are going to use alternative methods, more efficient and convenient for reading and handle these large datasets.</p>
<p>One of those tricks is the use of the package <em>data.table</em>, very handy for large datasets. In the following lines, we will compare reading/writting data with the function <code>fread()</code> and <code>fwrite().</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="co">#load the package may require installing it before</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(data.table)){</span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">install.packages</span>(<span class="st">"data.table"</span>)</span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: data.table</code></pre>
</div>
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="co"># if that doesn't work try: install.packages("data.table", type = "source", repos = "https://Rdatatable.gitlab.io/data.table")</span></span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>(vaccines <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="at">file =</span> <span class="st">'data/vaccines_EU_22oct2022.csv'</span>, <span class="at">header=</span><span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   user  system elapsed 
  2.708   0.111   2.889 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>(vaccines<span class="ot">&lt;-</span><span class="fu">fread</span>(<span class="st">'data/vaccines_EU_22oct2022.csv'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   user  system elapsed 
  1.469   0.058   0.208 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="co">#we can also prevent loading of some columns  to save time</span></span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>(vaccines2 <span class="ot">&lt;-</span><span class="fu">fread</span>(<span class="st">'data/vaccines_EU_22oct2022.csv'</span>,<span class="at">drop=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">5</span>,<span class="dv">7</span>,<span class="dv">9</span>,<span class="dv">10</span>)))  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   user  system elapsed 
  1.107   0.043   0.146 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>(vaccines3 <span class="ot">&lt;-</span><span class="fu">fread</span>(<span class="st">'data/vaccines_EU_22oct2022.csv'</span>,<span class="at">colClasses =</span> <span class="st">"character"</span>)) <span class="co">#we can also select the variables by type</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   user  system elapsed 
  3.757   0.104   0.488 </code></pre>
</div>
</div>
</section>
<section id="frequency-tables-table-vs.-xtabs" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="frequency-tables-table-vs.-xtabs"><span class="header-section-number">2.2</span> Frequency tables: <code>table()</code> vs.&nbsp;<code>xtabs()</code></h2>
<p>Tabulate frequencies is very common and quick way to obtain information from a dataset. A good alternative for complex tabulation and/or large datasets is the funcion <code>xtabs()</code>. The output of both <code>xtabs()</code> and <code>table()</code> is nearly the same, although <code>xtabs()</code> is more convenient for complex cross tabulations. Still some users prefer the use of derivative <code>table()</code> uses, like including it within the <code>with()</code> function. I believe that <code>xtabs()</code> provides a more straightforward alternative. Moreover, <code>xtabs()</code> has interesting advantages: 1) row and column labels are included automatically, set to the variable names and 2) there is a data= argument, which means you just have to reference the variable names. With <code>xtabs()</code>, you do not list out the variables of interest separated by commas. Instead you use formula notation, which is ~variable1+variable2+… where variable1 and variable2 are the names of the variables of interest.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="co">#compare table() and xtabs()</span></span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(vaccines<span class="sc">$</span>ReportingCountry)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    AT     BE     BG     CY     CZ     DE     DK     EE     EL     ES     FI 
 17292   7330   6001   7098   6593    564   4821   7755  16413  12960 407160 
    FR     HR     HU     IE     IS     IT     LI     LT     LU     LV     MT 
 22743   9270   6712   6367   5215  16507   5070  11118  10476   5454   5964 
    NL     NO     PL     PT     RO     SE     SI     SK 
 14355   4467 160225  13416   5867   9313   3131   3710 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(<span class="fu">table</span>(vaccines<span class="sc">$</span>ReportingCountry))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> 'table' int [1:30(1d)] 17292 7330 6001 7098 6593 564 4821 7755 16413 12960 ...
 - attr(*, "dimnames")=List of 1
  ..$ : chr [1:30] "AT" "BE" "BG" "CY" ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="fu">xtabs</span>(<span class="at">formula=</span> <span class="sc">~</span> ReportingCountry  ,<span class="at">data=</span>vaccines)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ReportingCountry
    AT     BE     BG     CY     CZ     DE     DK     EE     EL     ES     FI 
 17292   7330   6001   7098   6593    564   4821   7755  16413  12960 407160 
    FR     HR     HU     IE     IS     IT     LI     LT     LU     LV     MT 
 22743   9270   6712   6367   5215  16507   5070  11118  10476   5454   5964 
    NL     NO     PL     PT     RO     SE     SI     SK 
 14355   4467 160225  13416   5867   9313   3131   3710 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(<span class="fu">xtabs</span>(<span class="at">formula=</span> <span class="sc">~</span> ReportingCountry  ,<span class="at">data=</span>vaccines))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> 'xtabs' int [1:30(1d)] 17292 7330 6001 7098 6593 564 4821 7755 16413 12960 ...
 - attr(*, "dimnames")=List of 1
  ..$ ReportingCountry: chr [1:30] "AT" "BE" "BG" "CY" ...
 - attr(*, "call")= language xtabs(formula = ~ReportingCountry, data = vaccines)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Note: library(stats) if xtabs() does not work</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>So far the seem very similar in terms of coding and obtained output. However, what about if you want to use to variables?</p>
<div class="cell" data-output.lines="[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25]">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="co">#with 2 or more variables?</span></span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(vaccines[,<span class="fu">c</span>(ReportingCountry,<span class="fu">as.factor</span>(Vaccine))]) <span class="co">#not really</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
     1     10     11     12     13     14     15     16     17     18     19 
108389 117037   8332   3003   2317  92285   1973   1385    681  74429  46812 
     2      3      4      5      6      7      8      9     AT     BE     BG 
  2342    344 124068  58714  59509   2533     83 109131  17292   7330   6001 
    CY     CZ     DE     DK     EE     EL     ES     FI     FR     HR     HU 
  7098   6593    564   4821   7755  16413  12960 407160  22743   9270   6712 
    IE     IS     IT     LI     LT     LU     LV     MT     NL     NO     PL 
  6367   5215  16507   5070  11118  10476   5454   5964  14355   4467 160225 
    PT     RO     SE     SI     SK 
 13416   5867   9313   3131   3710 
NA
NA
NA
NA
NA
NA
NA
NA
NA
NA
NA
NA
NA
NA
--- Cropped output ---</code></pre>
</div>
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="do">## you can use "with", but not so intuitive to me</span></span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(vaccines, <span class="fu">table</span>(ReportingCountry, <span class="fu">as.factor</span>(Vaccine))) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                
ReportingCountry    AZ BECNBG BHACOV   COM COMBA.1 COMBA.4-5 COMBIV COMXBB
              AT  1572      0      0  1572    1572      1572      0      0
              BE   920      0      0  1540     640       620      0      0
              BG  1500      0      0  1551       0         0      0      0
              CY  1130      0      0  1530     264       641      0      0
              CZ   581      0      0  1758     433       645      0     32
              DE     0      0      0     0       0         0      0      0
              DK   600      0      0  1487     406       512      0      0
              EE  1274      0      0  1351     504       477      0      0
              EL  2320      0      0  2413    2320      2372      0      0
              ES  2160      0      0  2160       0         0   2160      0
              FI 45240      0      0 45240   45240     45240      0      0
              FR   133      0      0   133       0       133      0      0
              HR  1410      0      0  2175       0         0      0      0
              HU   701   1130      0  1426     495         0      0      0
              IE   704      0      0  1794     533       711      0      0
              IS   646      0      0  1736     492       411      0      0
              IT  1318      0      0  4176    1464      1591      0      0
              LI     0      0      0  1430     500         0      0      0
              LT  2346      0      0  2465       0         0      0      0
              LU  1668      0      0  1740     672       852      0     48
              LV   465      0      0  1275     415       434      0      0
              MT  1524      0      0  1549       0         0      0      0
              NL  1595      0      0  1595    1595      1595      0      0
--- Cropped output ---</code></pre>
</div>
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="co">#more strightforward alternative with xtabs</span></span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a>(vaccines_split <span class="ot">&lt;-</span> <span class="fu">xtabs</span>(<span class="at">formula=</span> <span class="sc">~</span> ReportingCountry  <span class="sc">+</span> <span class="fu">as.factor</span>(Vaccine), <span class="at">data =</span> vaccines))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                as.factor(Vaccine)
ReportingCountry    AZ BECNBG BHACOV   COM COMBA.1 COMBA.4-5 COMBIV COMXBB
              AT  1572      0      0  1572    1572      1572      0      0
              BE   920      0      0  1540     640       620      0      0
              BG  1500      0      0  1551       0         0      0      0
              CY  1130      0      0  1530     264       641      0      0
              CZ   581      0      0  1758     433       645      0     32
              DE     0      0      0     0       0         0      0      0
              DK   600      0      0  1487     406       512      0      0
              EE  1274      0      0  1351     504       477      0      0
              EL  2320      0      0  2413    2320      2372      0      0
              ES  2160      0      0  2160       0         0   2160      0
              FI 45240      0      0 45240   45240     45240      0      0
              FR   133      0      0   133       0       133      0      0
              HR  1410      0      0  2175       0         0      0      0
              HU   701   1130      0  1426     495         0      0      0
              IE   704      0      0  1794     533       711      0      0
              IS   646      0      0  1736     492       411      0      0
              IT  1318      0      0  4176    1464      1591      0      0
              LI     0      0      0  1430     500         0      0      0
              LT  2346      0      0  2465       0         0      0      0
              LU  1668      0      0  1740     672       852      0     48
              LV   465      0      0  1275     415       434      0      0
              MT  1524      0      0  1549       0         0      0      0
              NL  1595      0      0  1595    1595      1595      0      0
--- Cropped output ---</code></pre>
</div>
</div>
<p>As shown above, <code>xtabs()</code> can be used with more than two variables, although the resulting cross-tabulated table may be too long. Moreover, you can create a cross-tabulated table using a numeric variable instead of frequencies. To do so, you just need to use the left side of the formula.</p>
<div class="cell" data-output.lines="[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50]">
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="co">#also with several variables</span></span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a>(vaccines_split2 <span class="ot">&lt;-</span> <span class="fu">xtabs</span>(NumberDosesReceived <span class="sc">~</span> ReportingCountry  <span class="sc">+</span> <span class="fu">as.factor</span>(Vaccine) <span class="sc">+</span> <span class="fu">as.factor</span>(TargetGroup), vaccines))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>, , as.factor(TargetGroup) = 1_Age&lt;60

                as.factor(Vaccine)
ReportingCountry        AZ    BECNBG    BHACOV       COM   COMBA.1 COMBA.4-5
              AT         0         0         0         0         0         0
              BE         0         0         0         0         0         0
              BG         0         0         0         0         0         0
              CY         0         0         0         0         0         0
              CZ         0         0         0         0         0         0
              DE         0         0         0         0         0         0
              DK         0         0         0         0         0         0
              EE         0         0         0         0         0         0
              EL                   0         0                              
              ES         0         0         0         0         0         0
              FI         0         0         0         0         0         0
              FR         0         0         0         0         0         0
              HR         0         0         0         0         0         0
              HU         0         0         0         0         0         0
              IE         0         0         0         0         0         0
              IS         0         0         0         0         0         0
              IT         0         0         0         0         0         0
              LI         0         0         0         0         0         0
              LT         0         0         0         0         0         0
              LU         0         0         0         0         0         0
              LV         0         0         0         0         0         0
              MT         0         0         0         0         0         0
              NL         0         0         0         0         0         0
              NO         0         0         0         0         0         0
              PL         0         0         0         0         0         0
              PT         0         0         0         0         0         0
              RO                   0         0                   0         0
              SE         0         0         0         0         0         0
              SI         0         0         0         0         0         0
              SK         0         0         0         0         0         0
                as.factor(Vaccine)
ReportingCountry    COMBIV    COMXBB     JANSS       MOD   MODBA.1 MODBA.4-5
              AT         0         0         0         0         0         0
              BE         0         0         0         0         0         0
              BG         0         0         0         0         0         0
              CY         0         0         0         0         0         0
              CZ         0         0         0         0         0         0
              DE         0         0         0         0         0         0
              DK         0         0         0         0         0         0
              EE         0         0         0         0         0         0
              EL         0         0                             0         0
              ES         0         0         0         0         0         0
              FI         0         0         0         0         0         0
              FR         0         0         0         0         0         0
              HR         0         0         0         0         0         0
              HU         0         0         0         0         0         0
--- Cropped output ---</code></pre>
</div>
</div>
<p>Then, if you want to show your tabulated data in a more useful format, you can covert the cross-tabulated data into a flat table with <code>ftable()</code>. See the examples below and try to understand how the <code>row.bars</code> statement works.</p>
<div class="cell" data-output.lines="[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25]">
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ftable</span>(vaccines_split, <span class="at">row.vars =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   ReportingCountry    AT    BE    BG    CY    CZ    DE    DK    EE    EL    ES    FI    FR    HR    HU    IE    IS    IT    LI    LT    LU    LV    MT    NL    NO    PL    PT    RO    SE    SI    SK
as.factor(Vaccine)                                                                                                                                                                                                     
AZ                                   1572   920  1500  1130   581     0   600  1274  2320  2160 45240   133  1410   701   704   646  1318     0  2346  1668   465  1524  1595   602 32045  1548  1417  2320   376   274
BECNBG                                  0     0     0     0     0     0     0     0     0     0     0     0     0  1130     0     0     0     0     0     0     0     0     0     0     0  1212     0     0     0     0
BHACOV                                  0     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0   344     0     0     0     0
COM                                  1572  1540  1551  1530  1758     0  1487  1351  2413  2160 45240   133  2175  1426  1794  1736  4176  1430  2465  1740  1275  1549  1595  1248 32045  2480  1549  2320  1022  1308
COMBA.1                              1572   640     0   264   433     0   406   504  2320     0 45240     0     0   495   533   492  1464   500     0   672   415     0  1595   305     0   864     0     0     0     0
COMBA.4-5                            1572   620     0   641   645     0   512   477  2372     0 45240   133     0     0   711   411  1591     0     0   852   434     0  1595   436     0  1267     0     0     0     0
COMBIV                                  0     0     0     0     0     0     0     0     0  2160     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0   373     0
COMXBB                                  0     0     0     0    32     0     0     0     0     0     0     0     0     0     0     0     0     0     0    48     0     0     0     0     0     0     0     0     3     0
JANSS                                1572  1160  1400  1153   879     0   648  1169  2348  2160 45240   133  2025  1266   550   877  1737  1040  2176  1560   854  1396  1595   438 32045  1410  1362     0   328   610
MOD                                  1572  1320  1550  1108  1364     0  1118  1306  2320  2160 45240   133  1950  1180  1069   809  3079  1430  2414  1704  1016  1495  1595  1002 32045  1672  1539  2320   718   809
MODBA.1                              1572   460     0   264   350     0     0   504     0     0     0   133     0     0   363     4   850   510     0   672   318     0  1595   150     0   587     0     0     0     0
MODBA.4-5                               0     0     0   432    69     0     0   414     0     0     0   133     0     0   225    29   732     0     0   552     3     0     0   286     0   128     0     0     0     0
MODBIV                                  0     0     0     0     0     0     0     0     0  2160     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0   157     0
NVXD                                 1572   670     0   576   443     0     0   756  2320     0 45240   133   465     0   418    91  1415   160     0  1008   227     0  1595     0 32045   441     0  2320   151   239
SGSK                                 1572     0     0     0    39     0     0     0     0     0     0   133     0     0     0     0   145     0     0     0     3     0     0     0     0    78     0     0     3     0
SIN                                     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0  1385     0     0     0     0
SPU                                     0     0     0     0     0     0     0     0     0     0     0     0     0   514     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0   167
UNK                                  1572     0     0     0     0   564    50     0     0     0 45240 21546  1245     0     0   120     0     0  1717     0   444     0  1595     0     0     0     0    33     0   303
VLA                                  1572     0     0     0     0     0     0     0     0     0 45240     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0
NA
NA
NA
NA
--- Cropped output ---</code></pre>
</div>
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ftable</span>(vaccines_split2, <span class="at">row.vars =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   ReportingCountry              AT                                                                                                                                                                        BE                                                                                                                                                                        BG                                                                                                                                                                        CY                                                                                                                                                                        CZ                                                                                                                                                                        DE                                                                                                                                                                        DK                                                                                                                                                                        EE                                                                                                                                                                        EL                                                                                                                                                                        ES                                                                                                                                                                        FI                                                                                                                                                                        FR                                                                                                                                                                        HR                                                                                                                                                                        HU                                                                                                                                                                        IE                                                                                                                                                                        IS                                                                                                                                                                        IT                                                                                                                                                                        LI                                                                                                                                                                        LT                                                                                                                                                                        LU                                                                                                                                                                        LV                                                                                                                                                                        MT                                                                                                                                                                        NL                                                                                                                                                                        NO                                                                                                                                                                        PL                                                                                                                                                                        PT                                                                                                                                                                        RO                                                                                                                                                                        SE                                                                                                                                                                        SI                                                                                                                                                                        SK                                                                                                                                                                
                   as.factor(TargetGroup)  1_Age&lt;60  1_Age60+    Age&lt;18    Age0_4  Age10_14  Age15_17  Age18_24  Age25_49    Age5_9  Age50_59  Age60_69  Age70_79    Age80+    AgeUNK       ALL       HCW      LTCF  1_Age&lt;60  1_Age60+    Age&lt;18    Age0_4  Age10_14  Age15_17  Age18_24  Age25_49    Age5_9  Age50_59  Age60_69  Age70_79    Age80+    AgeUNK       ALL       HCW      LTCF  1_Age&lt;60  1_Age60+    Age&lt;18    Age0_4  Age10_14  Age15_17  Age18_24  Age25_49    Age5_9  Age50_59  Age60_69  Age70_79    Age80+    AgeUNK       ALL       HCW      LTCF  1_Age&lt;60  1_Age60+    Age&lt;18    Age0_4  Age10_14  Age15_17  Age18_24  Age25_49    Age5_9  Age50_59  Age60_69  Age70_79    Age80+    AgeUNK       ALL       HCW      LTCF  1_Age&lt;60  1_Age60+    Age&lt;18    Age0_4  Age10_14  Age15_17  Age18_24  Age25_49    Age5_9  Age50_59  Age60_69  Age70_79    Age80+    AgeUNK       ALL       HCW      LTCF  1_Age&lt;60  1_Age60+    Age&lt;18    Age0_4  Age10_14  Age15_17  Age18_24  Age25_49    Age5_9  Age50_59  Age60_69  Age70_79    Age80+    AgeUNK       ALL       HCW      LTCF  1_Age&lt;60  1_Age60+    Age&lt;18    Age0_4  Age10_14  Age15_17  Age18_24  Age25_49    Age5_9  Age50_59  Age60_69  Age70_79    Age80+    AgeUNK       ALL       HCW      LTCF  1_Age&lt;60  1_Age60+    Age&lt;18    Age0_4  Age10_14  Age15_17  Age18_24  Age25_49    Age5_9  Age50_59  Age60_69  Age70_79    Age80+    AgeUNK       ALL       HCW      LTCF  1_Age&lt;60  1_Age60+    Age&lt;18    Age0_4  Age10_14  Age15_17  Age18_24  Age25_49    Age5_9  Age50_59  Age60_69  Age70_79    Age80+    AgeUNK       ALL       HCW      LTCF  1_Age&lt;60  1_Age60+    Age&lt;18    Age0_4  Age10_14  Age15_17  Age18_24  Age25_49    Age5_9  Age50_59  Age60_69  Age70_79    Age80+    AgeUNK       ALL       HCW      LTCF  1_Age&lt;60  1_Age60+    Age&lt;18    Age0_4  Age10_14  Age15_17  Age18_24  Age25_49    Age5_9  Age50_59  Age60_69  Age70_79    Age80+    AgeUNK       ALL       HCW      LTCF  1_Age&lt;60  1_Age60+    Age&lt;18    Age0_4  Age10_14  Age15_17  Age18_24  Age25_49    Age5_9  Age50_59  Age60_69  Age70_79    Age80+    AgeUNK       ALL       HCW      LTCF  1_Age&lt;60  1_Age60+    Age&lt;18    Age0_4  Age10_14  Age15_17  Age18_24  Age25_49    Age5_9  Age50_59  Age60_69  Age70_79    Age80+    AgeUNK       ALL       HCW      LTCF  1_Age&lt;60  1_Age60+    Age&lt;18    Age0_4  Age10_14  Age15_17  Age18_24  Age25_49    Age5_9  Age50_59  Age60_69  Age70_79    Age80+    AgeUNK       ALL       HCW      LTCF  1_Age&lt;60  1_Age60+    Age&lt;18    Age0_4  Age10_14  Age15_17  Age18_24  Age25_49    Age5_9  Age50_59  Age60_69  Age70_79    Age80+    AgeUNK       ALL       HCW      LTCF  1_Age&lt;60  1_Age60+    Age&lt;18    Age0_4  Age10_14  Age15_17  Age18_24  Age25_49    Age5_9  Age50_59  Age60_69  Age70_79    Age80+    AgeUNK       ALL       HCW      LTCF  1_Age&lt;60  1_Age60+    Age&lt;18    Age0_4  Age10_14  Age15_17  Age18_24  Age25_49    Age5_9  Age50_59  Age60_69  Age70_79    Age80+    AgeUNK       ALL       HCW      LTCF  1_Age&lt;60  1_Age60+    Age&lt;18    Age0_4  Age10_14  Age15_17  Age18_24  Age25_49    Age5_9  Age50_59  Age60_69  Age70_79    Age80+    AgeUNK       ALL       HCW      LTCF  1_Age&lt;60  1_Age60+    Age&lt;18    Age0_4  Age10_14  Age15_17  Age18_24  Age25_49    Age5_9  Age50_59  Age60_69  Age70_79    Age80+    AgeUNK       ALL       HCW      LTCF  1_Age&lt;60  1_Age60+    Age&lt;18    Age0_4  Age10_14  Age15_17  Age18_24  Age25_49    Age5_9  Age50_59  Age60_69  Age70_79    Age80+    AgeUNK       ALL       HCW      LTCF  1_Age&lt;60  1_Age60+    Age&lt;18    Age0_4  Age10_14  Age15_17  Age18_24  Age25_49    Age5_9  Age50_59  Age60_69  Age70_79    Age80+    AgeUNK       ALL       HCW      LTCF  1_Age&lt;60  1_Age60+    Age&lt;18    Age0_4  Age10_14  Age15_17  Age18_24  Age25_49    Age5_9  Age50_59  Age60_69  Age70_79    Age80+    AgeUNK       ALL       HCW      LTCF  1_Age&lt;60  1_Age60+    Age&lt;18    Age0_4  Age10_14  Age15_17  Age18_24  Age25_49    Age5_9  Age50_59  Age60_69  Age70_79    Age80+    AgeUNK       ALL       HCW      LTCF  1_Age&lt;60  1_Age60+    Age&lt;18    Age0_4  Age10_14  Age15_17  Age18_24  Age25_49    Age5_9  Age50_59  Age60_69  Age70_79    Age80+    AgeUNK       ALL       HCW      LTCF  1_Age&lt;60  1_Age60+    Age&lt;18    Age0_4  Age10_14  Age15_17  Age18_24  Age25_49    Age5_9  Age50_59  Age60_69  Age70_79    Age80+    AgeUNK       ALL       HCW      LTCF  1_Age&lt;60  1_Age60+    Age&lt;18    Age0_4  Age10_14  Age15_17  Age18_24  Age25_49    Age5_9  Age50_59  Age60_69  Age70_79    Age80+    AgeUNK       ALL       HCW      LTCF  1_Age&lt;60  1_Age60+    Age&lt;18    Age0_4  Age10_14  Age15_17  Age18_24  Age25_49    Age5_9  Age50_59  Age60_69  Age70_79    Age80+    AgeUNK       ALL       HCW      LTCF  1_Age&lt;60  1_Age60+    Age&lt;18    Age0_4  Age10_14  Age15_17  Age18_24  Age25_49    Age5_9  Age50_59  Age60_69  Age70_79    Age80+    AgeUNK       ALL       HCW      LTCF  1_Age&lt;60  1_Age60+    Age&lt;18    Age0_4  Age10_14  Age15_17  Age18_24  Age25_49    Age5_9  Age50_59  Age60_69  Age70_79    Age80+    AgeUNK       ALL       HCW      LTCF  1_Age&lt;60  1_Age60+    Age&lt;18    Age0_4  Age10_14  Age15_17  Age18_24  Age25_49    Age5_9  Age50_59  Age60_69  Age70_79    Age80+    AgeUNK       ALL       HCW      LTCF
as.factor(Vaccine)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
AZ                                                0         0         0         0         0         0         0         0         0         0         0         0         0         0   5519600         0         0         0         0        NA         0         0         0        NA        NA         0        NA        NA        NA        NA        NA        NA        NA        NA         0         0        NA         0         0         0        NA        NA         0        NA        NA        NA        NA        NA        NA        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0    432300         0         0         0         0        NA         0         0        NA        NA        NA         0        NA        NA        NA        NA         0   1628400        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0    202920         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0    818300         0         0        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA   4035800        NA         0         0         0        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA         0         0        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0  10355500         0         0         0         0        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA         0         0        NA         0         0         0        NA        NA         0        NA        NA        NA        NA        NA   6513800        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0   1442700         0         0         0         0         0     97800     97800     97800     97800     97800     97800     97800     97800     97800     97800     97800    100880     97800     97800         0         0        NA         0         0         0        NA        NA         0        NA        NA        NA        NA         0        NA        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0   1121594         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0    186600         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0   1273400         0         0         0         0        NA         0         0         0        NA        NA         0        NA        NA        NA        NA        NA        NA        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0   4503400         0         0         0         0        NA         0         0         0        NA        NA         0        NA        NA        NA        NA         0    578400        NA         0         0         0         0        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA         0         0         0         0        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA         0         0        NA        NA         0         0         0         0        NA        NA         0        NA        NA        NA        NA         0   2999600        NA        NA         0         0         0         0         0        NA        NA        NA         0        NA        NA        NA        NA         0        NA         0         0         0         0        NA         0         0         0        NA        NA         0        NA        NA        NA        NA         0   1123800        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0   1612810         0         0
BECNBG                                            0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA         0         0         0        NA        NA         0        NA        NA        NA        NA        NA   5187056        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0
BHACOV                                            0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA        NA        NA        NA        NA        NA         0        NA        NA        NA        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0
COM                                               0         0         0         0         0         0         0         0         0         0         0         0         0         0  24394773         0         0         0         0        NA         0         0         0        NA        NA         0        NA        NA        NA        NA        NA        NA        NA        NA         0         0        NA         0         0         0        NA        NA         0        NA        NA        NA        NA        NA   7265580        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0   2033293         0         0         0         0        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA         0  21204560        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0   7614360         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0   2304060         0         0        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA  25348740        NA        NA         0         0        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA 100959011        NA        NA         0         0        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0 136804000         0         0         0         0        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA         0         0        NA         0         0         0        NA        NA         0        NA        NA        NA        NA        NA  13163840        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0  11135050         0         0         0         0         0        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA    794870        NA        NA         0         0        NA         0         0         0        NA        NA         0        NA        NA        NA        NA         0        NA        NA        NA         0         0         0         0         0         0       763         0         0         0         0         0         0         0     22650         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0   6789378         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0   1346640         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0   3001755         0         0         0         0        NA         0         0         0        NA        NA         0        NA        NA        NA        NA        NA        NA        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0  34003726         0         0         0         0        NA         0         0         0        NA        NA         0        NA        NA        NA        NA         0  11373105        NA         0         0         0         0        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA         0         0         0         0        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA         0         0        NA        NA        NA         0         0         0        NA        NA         0        NA        NA        NA        NA         0  18276235        NA        NA         0         0         0         0         0        NA        NA        NA         0        NA        NA        NA        NA         0        NA         0         0         0         0        NA         0         0         0        NA        NA         0        NA        NA        NA        NA         0   3987390        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0   7723560         0         0
COMBA.1                                           0         0         0         0         0         0         0         0         0         0         0         0         0         0   1512000         0         0         0         0        NA         0         0         0        NA        NA         0        NA        NA        NA        NA        NA        NA        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA         0        NA        NA        NA        NA        NA        NA        NA        NA        NA         0   1321920        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0    279360         0         0        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA    800640        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA         0         0         0        NA        NA         0        NA        NA        NA        NA        NA    216000         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA    126720        NA        NA         0         0        NA         0         0         0        NA        NA         0        NA        NA        NA        NA         0        NA        NA        NA         0         0         0         0         0         0      1020         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0     86400         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0    460800         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0   2871360         0         0         0         0        NA         0         0         0        NA        NA         0        NA        NA        NA        NA         0    889920        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0
COMBA.4-5                                         0         0         0         0         0         0         0         0         0         0         0         0         0         0   5530560         0         0         0         0        NA         0         0         0        NA        NA         0        NA        NA        NA        NA        NA        NA        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0     37440         0         0         0         0        NA         0        NA        NA        NA        NA        NA        NA        NA        NA        NA         0   5135040        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0    350400         0         0        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA   1428480        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0  23481600         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA    100800        NA        NA         0         0        NA         0         0         0        NA        NA         0        NA        NA        NA        NA         0        NA        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0    168000         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0   1088640         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0   6325440         0         0         0         0        NA         0         0         0        NA        NA         0        NA        NA        NA        NA         0   2453760        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0
COMBIV                                            0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA         0         0         0        NA        NA         0        NA        NA        NA        NA         0    800640        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0
COMXBB                                            0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA         0        NA        NA        NA        NA         0        NA        NA        NA        NA         0     97920        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0     18240         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0     58560         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0
JANSS                                             0         0         0         0         0         0         0         0         0         0         0         0         0         0   1292400         0         0         0         0        NA         0         0         0        NA        NA         0        NA        NA        NA        NA        NA        NA        NA        NA         0         0        NA         0         0         0        NA        NA         0        NA        NA        NA        NA        NA        NA        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0    190100         0         0         0         0        NA         0        NA        NA        NA        NA         0        NA        NA        NA        NA         0   1396200        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0     42300         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0    120800         0         0        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA   2401800        NA        NA         0         0        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA         0         0        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0   3732300         0         0         0         0        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA         0         0        NA         0         0         0        NA        NA         0        NA        NA        NA        NA        NA   4309200        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0    281500         0         0         0         0         0        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA     57500        NA        NA         0         0        NA         0         0         0        NA        NA         0        NA        NA        NA        NA         0        NA        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0       650         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0    653097         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0     80250         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0   1259800         0         0         0         0        NA         0         0         0        NA        NA         0        NA        NA        NA        NA        NA        NA        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0   2464800         0         0         0         0        NA         0         0         0        NA        NA         0        NA        NA        NA        NA         0    403900        NA         0         0         0         0        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA         0         0         0         0        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA         0         0        NA        NA         0         0         0         0        NA        NA         0        NA        NA        NA        NA         0   2820300        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA         0         0         0        NA        NA         0        NA        NA        NA        NA         0    230400        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0    475200         0         0
MOD                                               0         0         0         0         0         0         0         0         0         0         0         0         0         0   5963500         0         0         0         0        NA         0         0         0        NA        NA         0        NA        NA        NA        NA        NA        NA        NA        NA         0         0        NA         0         0         0        NA        NA         0        NA        NA        NA        NA        NA        NA        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0    155200         0         0         0         0        NA         0        NA        NA        NA        NA         0        NA        NA        NA        NA         0   3685100        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0   1350690         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0    270400         0         0        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA   1770000        NA         0         0         0        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA         0         0        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0  54929280         0         0         0         0        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA         0         0        NA         0         0         0        NA        NA         0        NA        NA        NA        NA        NA   1736400        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0   3290500         0         0         0         0         0        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA    261720        NA        NA         0         0        NA         0         0         0        NA        NA         0        NA        NA        NA        NA         0        NA        NA        NA         0         0         0         0         0         0       680         0         0         0         0         0         0         0     44500         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0    732830         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0    302610         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0   1171300         0         0         0         0        NA         0         0         0        NA        NA         0        NA        NA        NA        NA        NA        NA        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0  11327200         0         0         0         0        NA         0         0         0        NA        NA         0        NA        NA        NA        NA         0   3982600        NA         0         0         0         0        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA         0         0         0         0        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA         0         0        NA        NA        NA         0         0         0        NA        NA         0        NA        NA        NA        NA         0   2805700        NA        NA         0         0         0         0         0        NA        NA        NA         0        NA        NA        NA        NA         0        NA         0         0         0         0        NA         0         0         0        NA        NA         0        NA        NA        NA        NA         0    714400        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0    871200         0         0
MODBA.1                                           0         0         0         0         0         0         0         0         0         0         0         0         0         0   2474610         0         0         0         0        NA         0         0         0        NA        NA         0        NA        NA        NA        NA        NA        NA        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0     24250         0         0         0         0        NA         0        NA        NA        NA        NA         0        NA        NA        NA        NA         0    199700        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0    192750         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0   8321200         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0     65350         0         0         0         0        NA         0         0         0        NA        NA         0        NA        NA        NA        NA         0        NA        NA        NA         0         0         0         0         0         0      2505         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0    303240         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0    543980         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0   6175700         0         0         0         0         0         0         0         0        NA        NA         0        NA        NA        NA        NA         0   1443150        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA        NA        NA        NA         0        NA        NA        NA        NA        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0
MODBA.4-5                                         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0      9500         0         0         0         0         0         0         0         0        NA        NA         0        NA        NA        NA        NA         0     46750        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0     98400         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0   3315650         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0     98350         0         0         0         0        NA         0         0         0        NA        NA         0        NA        NA        NA        NA         0        NA        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0    243300         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0    123600         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA        NA         0        NA        NA        NA        NA         0   2271400        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA        NA         0        NA        NA        NA         0         0        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0
MODBIV                                            0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA        NA         0        NA        NA        NA        NA         0    705400        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0
NVXD                                              0         0         0         0         0         0         0         0         0         0         0         0         0         0   3192000         0         0         0         0        NA         0         0         0        NA        NA         0        NA        NA        NA        NA        NA        NA        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0     90000         0         0         0         0        NA         0        NA        NA        NA        NA         0        NA        NA        NA        NA         0    578000        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0     60800         0         0        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA    396000        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0   2965000         0         0         0         0        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0    198000         0         0         0         0         0        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA     42000        NA        NA         0         0        NA         0         0         0        NA        NA         0        NA        NA        NA        NA         0        NA        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0    105000         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0    189600         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0    707000         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA         0         0         0         0        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA         0        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA        NA        NA         0        NA        NA        NA        NA         0        NA         0         0         0         0        NA         0         0         0        NA        NA         0        NA        NA        NA        NA         0     94000         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0     93000         0         0
SGSK                                              0         0         0         0         0         0         0         0         0         0         0         0         0         0   2243300         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0     64800         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0  16576400         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA         0         0         0        NA        NA         0        NA        NA        NA        NA         0        NA        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0    108000         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA        NA        NA        NA        NA        NA        NA         0        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA         0         0         0         0    115200         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0
SIN                                               0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0
SPU                                               0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA         0         0         0        NA        NA         0        NA        NA        NA        NA        NA   2000000        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0    200000         0         0
UNK                                               0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA        NA        NA         0         0         0         0         0         0         0         0         0         0         0 241419933         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA         0         0         0         0        NA         0         0         0        NA        NA         0        NA        NA        NA        NA        NA        NA         0         0         0         0        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0     10162         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0
VLA                                               0         0         0         0         0         0         0         0         0         0         0         0         0         0    151200         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0
NA
NA
NA
--- Cropped output ---</code></pre>
</div>
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ftable</span>(vaccines_split2, <span class="at">row.vars =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                       ReportingCountry          AT                                                                                                                                                                                            BE                                                                                                                                                                                            BG                                                                                                                                                                                            CY                                                                                                                                                                                            CZ                                                                                                                                                                                            DE                                                                                                                                                                                            DK                                                                                                                                                                                            EE                                                                                                                                                                                            EL                                                                                                                                                                                            ES                                                                                                                                                                                            FI                                                                                                                                                                                            FR                                                                                                                                                                                            HR                                                                                                                                                                                            HU                                                                                                                                                                                            IE                                                                                                                                                                                            IS                                                                                                                                                                                            IT                                                                                                                                                                                            LI                                                                                                                                                                                            LT                                                                                                                                                                                            LU                                                                                                                                                                                            LV                                                                                                                                                                                            MT                                                                                                                                                                                            NL                                                                                                                                                                                            NO                                                                                                                                                                                            PL                                                                                                                                                                                            PT                                                                                                                                                                                            RO                                                                                                                                                                                            SE                                                                                                                                                                                            SI                                                                                                                                                                                            SK                                                                                                                                                                                    
                       as.factor(Vaccine)        AZ    BECNBG    BHACOV       COM   COMBA.1 COMBA.4-5    COMBIV    COMXBB     JANSS       MOD   MODBA.1 MODBA.4-5    MODBIV      NVXD      SGSK       SIN       SPU       UNK       VLA        AZ    BECNBG    BHACOV       COM   COMBA.1 COMBA.4-5    COMBIV    COMXBB     JANSS       MOD   MODBA.1 MODBA.4-5    MODBIV      NVXD      SGSK       SIN       SPU       UNK       VLA        AZ    BECNBG    BHACOV       COM   COMBA.1 COMBA.4-5    COMBIV    COMXBB     JANSS       MOD   MODBA.1 MODBA.4-5    MODBIV      NVXD      SGSK       SIN       SPU       UNK       VLA        AZ    BECNBG    BHACOV       COM   COMBA.1 COMBA.4-5    COMBIV    COMXBB     JANSS       MOD   MODBA.1 MODBA.4-5    MODBIV      NVXD      SGSK       SIN       SPU       UNK       VLA        AZ    BECNBG    BHACOV       COM   COMBA.1 COMBA.4-5    COMBIV    COMXBB     JANSS       MOD   MODBA.1 MODBA.4-5    MODBIV      NVXD      SGSK       SIN       SPU       UNK       VLA        AZ    BECNBG    BHACOV       COM   COMBA.1 COMBA.4-5    COMBIV    COMXBB     JANSS       MOD   MODBA.1 MODBA.4-5    MODBIV      NVXD      SGSK       SIN       SPU       UNK       VLA        AZ    BECNBG    BHACOV       COM   COMBA.1 COMBA.4-5    COMBIV    COMXBB     JANSS       MOD   MODBA.1 MODBA.4-5    MODBIV      NVXD      SGSK       SIN       SPU       UNK       VLA        AZ    BECNBG    BHACOV       COM   COMBA.1 COMBA.4-5    COMBIV    COMXBB     JANSS       MOD   MODBA.1 MODBA.4-5    MODBIV      NVXD      SGSK       SIN       SPU       UNK       VLA        AZ    BECNBG    BHACOV       COM   COMBA.1 COMBA.4-5    COMBIV    COMXBB     JANSS       MOD   MODBA.1 MODBA.4-5    MODBIV      NVXD      SGSK       SIN       SPU       UNK       VLA        AZ    BECNBG    BHACOV       COM   COMBA.1 COMBA.4-5    COMBIV    COMXBB     JANSS       MOD   MODBA.1 MODBA.4-5    MODBIV      NVXD      SGSK       SIN       SPU       UNK       VLA        AZ    BECNBG    BHACOV       COM   COMBA.1 COMBA.4-5    COMBIV    COMXBB     JANSS       MOD   MODBA.1 MODBA.4-5    MODBIV      NVXD      SGSK       SIN       SPU       UNK       VLA        AZ    BECNBG    BHACOV       COM   COMBA.1 COMBA.4-5    COMBIV    COMXBB     JANSS       MOD   MODBA.1 MODBA.4-5    MODBIV      NVXD      SGSK       SIN       SPU       UNK       VLA        AZ    BECNBG    BHACOV       COM   COMBA.1 COMBA.4-5    COMBIV    COMXBB     JANSS       MOD   MODBA.1 MODBA.4-5    MODBIV      NVXD      SGSK       SIN       SPU       UNK       VLA        AZ    BECNBG    BHACOV       COM   COMBA.1 COMBA.4-5    COMBIV    COMXBB     JANSS       MOD   MODBA.1 MODBA.4-5    MODBIV      NVXD      SGSK       SIN       SPU       UNK       VLA        AZ    BECNBG    BHACOV       COM   COMBA.1 COMBA.4-5    COMBIV    COMXBB     JANSS       MOD   MODBA.1 MODBA.4-5    MODBIV      NVXD      SGSK       SIN       SPU       UNK       VLA        AZ    BECNBG    BHACOV       COM   COMBA.1 COMBA.4-5    COMBIV    COMXBB     JANSS       MOD   MODBA.1 MODBA.4-5    MODBIV      NVXD      SGSK       SIN       SPU       UNK       VLA        AZ    BECNBG    BHACOV       COM   COMBA.1 COMBA.4-5    COMBIV    COMXBB     JANSS       MOD   MODBA.1 MODBA.4-5    MODBIV      NVXD      SGSK       SIN       SPU       UNK       VLA        AZ    BECNBG    BHACOV       COM   COMBA.1 COMBA.4-5    COMBIV    COMXBB     JANSS       MOD   MODBA.1 MODBA.4-5    MODBIV      NVXD      SGSK       SIN       SPU       UNK       VLA        AZ    BECNBG    BHACOV       COM   COMBA.1 COMBA.4-5    COMBIV    COMXBB     JANSS       MOD   MODBA.1 MODBA.4-5    MODBIV      NVXD      SGSK       SIN       SPU       UNK       VLA        AZ    BECNBG    BHACOV       COM   COMBA.1 COMBA.4-5    COMBIV    COMXBB     JANSS       MOD   MODBA.1 MODBA.4-5    MODBIV      NVXD      SGSK       SIN       SPU       UNK       VLA        AZ    BECNBG    BHACOV       COM   COMBA.1 COMBA.4-5    COMBIV    COMXBB     JANSS       MOD   MODBA.1 MODBA.4-5    MODBIV      NVXD      SGSK       SIN       SPU       UNK       VLA        AZ    BECNBG    BHACOV       COM   COMBA.1 COMBA.4-5    COMBIV    COMXBB     JANSS       MOD   MODBA.1 MODBA.4-5    MODBIV      NVXD      SGSK       SIN       SPU       UNK       VLA        AZ    BECNBG    BHACOV       COM   COMBA.1 COMBA.4-5    COMBIV    COMXBB     JANSS       MOD   MODBA.1 MODBA.4-5    MODBIV      NVXD      SGSK       SIN       SPU       UNK       VLA        AZ    BECNBG    BHACOV       COM   COMBA.1 COMBA.4-5    COMBIV    COMXBB     JANSS       MOD   MODBA.1 MODBA.4-5    MODBIV      NVXD      SGSK       SIN       SPU       UNK       VLA        AZ    BECNBG    BHACOV       COM   COMBA.1 COMBA.4-5    COMBIV    COMXBB     JANSS       MOD   MODBA.1 MODBA.4-5    MODBIV      NVXD      SGSK       SIN       SPU       UNK       VLA        AZ    BECNBG    BHACOV       COM   COMBA.1 COMBA.4-5    COMBIV    COMXBB     JANSS       MOD   MODBA.1 MODBA.4-5    MODBIV      NVXD      SGSK       SIN       SPU       UNK       VLA        AZ    BECNBG    BHACOV       COM   COMBA.1 COMBA.4-5    COMBIV    COMXBB     JANSS       MOD   MODBA.1 MODBA.4-5    MODBIV      NVXD      SGSK       SIN       SPU       UNK       VLA        AZ    BECNBG    BHACOV       COM   COMBA.1 COMBA.4-5    COMBIV    COMXBB     JANSS       MOD   MODBA.1 MODBA.4-5    MODBIV      NVXD      SGSK       SIN       SPU       UNK       VLA        AZ    BECNBG    BHACOV       COM   COMBA.1 COMBA.4-5    COMBIV    COMXBB     JANSS       MOD   MODBA.1 MODBA.4-5    MODBIV      NVXD      SGSK       SIN       SPU       UNK       VLA        AZ    BECNBG    BHACOV       COM   COMBA.1 COMBA.4-5    COMBIV    COMXBB     JANSS       MOD   MODBA.1 MODBA.4-5    MODBIV      NVXD      SGSK       SIN       SPU       UNK       VLA
as.factor(TargetGroup)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
1_Age&lt;60                                          0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA         0         0        NA        NA        NA         0         0        NA        NA         0         0         0        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA         0         0        NA         0         0         0         0        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0
1_Age60+                                          0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA         0         0        NA        NA        NA         0         0        NA        NA         0         0         0        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA         0         0        NA         0         0         0         0        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0
Age&lt;18                                            0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA         0         0        NA        NA        NA         0         0        NA        NA        NA         0         0        NA         0         0         0         0         0        NA         0         0        NA         0         0         0         0        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA         0         0        NA        NA        NA         0        NA        NA        NA        NA         0         0        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA         0         0        NA        NA        NA         0         0        NA        NA         0         0         0        NA         0         0         0         0         0        NA         0         0        NA         0         0        NA         0        NA        NA         0         0        NA         0         0         0         0         0         0        NA         0         0        NA        NA        NA         0         0        NA        NA         0         0         0        NA         0         0         0        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA         0        NA         0         0        NA         0         0         0         0        NA        NA         0         0         0        NA         0         0         0        NA         0        NA        NA         0        NA        NA         0         0         0        NA        NA         0         0         0         0         0         0        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA         0         0        NA        NA        NA         0         0        NA        NA        NA        NA         0        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA         0         0        NA         0         0         0         0        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA         0         0        NA        NA        NA         0         0        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA         0         0         0         0         0        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA         0         0        NA         0         0        NA         0        NA        NA         0         0         0        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0
Age0_4                                            0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA         0         0        NA        NA        NA         0         0        NA        NA         0         0         0        NA         0         0         0         0         0        NA         0         0        NA         0         0        NA         0        NA        NA         0         0        NA         0         0         0         0         0         0        NA         0         0        NA        NA        NA         0         0        NA        NA         0         0         0        NA         0         0         0        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA         0         0        NA         0         0         0         0        NA        NA         0         0         0        NA         0         0         0        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0     97800         0         0        NA        NA        NA         0         0        NA        NA         0         0         0        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA         0         0        NA         0         0         0         0        NA        NA         0         0         0        NA         0         0         0         0         0        NA        NA        NA        NA        NA        NA         0         0        NA        NA         0         0         0        NA         0        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0
Age10_14                                          0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA        NA        NA         0        NA        NA        NA        NA         0         0        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA         0         0        NA        NA        NA         0         0        NA        NA         0         0         0        NA         0         0         0         0         0        NA         0         0        NA         0         0        NA         0        NA        NA         0         0        NA         0         0         0         0         0         0        NA         0         0        NA        NA        NA         0         0        NA        NA         0         0         0        NA         0         0         0        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA         0         0        NA         0         0         0         0        NA        NA         0         0         0        NA         0         0         0        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0     97800         0         0        NA        NA        NA         0         0        NA        NA         0         0         0        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA         0         0        NA         0         0         0         0        NA        NA         0         0         0        NA         0         0         0         0         0        NA        NA        NA        NA        NA        NA         0         0        NA        NA        NA         0         0        NA         0        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0
Age15_17                                          0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA         0         0        NA        NA        NA         0        NA        NA        NA        NA         0         0        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA         0         0        NA        NA        NA         0         0        NA        NA         0         0         0        NA         0         0         0         0         0        NA         0         0        NA         0         0        NA         0        NA        NA         0         0        NA         0         0         0         0         0         0        NA         0         0        NA        NA        NA         0         0        NA        NA         0         0         0        NA         0         0         0        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA         0         0        NA         0         0         0         0        NA        NA         0         0         0        NA         0         0         0        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0     97800         0         0        NA        NA        NA         0         0        NA        NA         0         0         0        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA         0         0        NA         0         0         0         0        NA        NA         0         0         0        NA         0         0         0         0         0        NA        NA        NA        NA        NA        NA         0         0        NA        NA        NA         0         0        NA         0        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA         0         0        NA         0         0         0         0         0        NA         0         0         0        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0
Age18_24                                          0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA         0         0        NA        NA        NA         0         0        NA        NA        NA         0         0        NA         0         0         0         0         0        NA         0         0        NA         0         0         0         0        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA         0         0        NA        NA        NA         0        NA        NA        NA        NA        NA         0        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA         0         0        NA        NA        NA         0         0        NA        NA         0         0         0        NA         0         0         0         0         0        NA         0         0        NA         0         0        NA         0        NA        NA         0         0        NA         0         0         0         0         0         0        NA         0         0        NA        NA        NA         0         0        NA        NA         0         0         0        NA         0         0         0        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA         0        NA         0         0        NA         0         0         0         0        NA        NA         0         0         0        NA         0         0         0        NA         0        NA        NA         0        NA        NA         0         0         0        NA        NA         0         0         0         0         0         0        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0     97800         0         0        NA        NA        NA         0         0        NA        NA         0         0         0        NA         0         0         0         0         0        NA         0         0        NA        NA        NA         0         0        NA        NA        NA        NA         0        NA        NA         0         0         0         0         0         0         0       763      1020         0         0         0         0       680      2505         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA         0         0        NA         0         0         0         0        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA         0         0        NA        NA        NA         0         0        NA        NA        NA        NA         0         0         0         0         0         0         0        NA         0         0        NA         0         0         0         0        NA        NA         0         0         0        NA         0         0         0         0         0        NA        NA        NA        NA        NA        NA         0         0        NA        NA        NA        NA         0        NA        NA        NA         0         0         0        NA         0         0        NA         0         0         0         0        NA        NA         0         0         0         0         0         0         0         0         0        NA         0         0        NA         0         0         0         0         0        NA         0         0         0        NA         0         0         0         0         0        NA         0         0        NA         0         0        NA         0        NA        NA         0         0        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0
Age25_49                                          0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA         0         0        NA        NA        NA         0         0        NA        NA        NA         0         0        NA         0         0         0         0         0        NA         0         0        NA         0         0         0         0        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA         0         0        NA        NA        NA         0        NA        NA        NA        NA        NA         0        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA         0         0        NA        NA        NA         0         0        NA        NA         0         0         0        NA         0         0         0         0         0        NA         0         0        NA         0         0        NA         0        NA        NA         0         0        NA         0         0         0         0         0         0        NA         0         0        NA        NA        NA         0         0        NA        NA         0         0         0        NA         0         0         0        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA         0        NA         0         0        NA         0         0         0         0        NA        NA         0         0         0        NA         0         0         0        NA         0        NA        NA         0        NA        NA         0         0         0        NA        NA         0         0         0         0         0         0        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0     97800         0         0        NA        NA        NA         0         0        NA        NA         0         0         0        NA         0         0         0         0         0        NA         0         0        NA        NA        NA         0         0        NA        NA        NA        NA         0        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA         0         0        NA         0         0         0         0        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA         0         0        NA        NA        NA         0         0        NA        NA        NA        NA         0         0         0         0         0         0         0        NA         0         0        NA         0         0         0         0        NA        NA         0         0         0        NA         0         0         0         0         0        NA        NA        NA        NA        NA        NA         0         0        NA        NA        NA        NA         0        NA        NA        NA         0         0         0        NA         0         0        NA         0         0         0         0        NA        NA         0         0         0         0         0         0         0         0         0        NA         0         0        NA         0         0         0         0         0        NA         0         0         0        NA         0         0         0         0         0        NA         0         0        NA         0         0        NA         0        NA        NA         0         0        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0
Age5_9                                            0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA         0         0        NA        NA        NA         0         0        NA        NA         0         0         0        NA         0         0         0         0         0        NA         0         0        NA         0         0        NA         0        NA        NA         0         0        NA         0         0         0         0         0         0        NA         0         0        NA        NA        NA         0         0        NA        NA         0         0         0        NA         0         0         0        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA         0         0        NA         0         0         0         0        NA        NA         0         0         0        NA         0         0         0        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0     97800         0         0        NA        NA        NA         0         0        NA        NA         0         0         0        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA         0         0        NA         0         0         0         0        NA        NA         0         0         0        NA         0         0         0         0         0        NA        NA        NA        NA        NA        NA         0         0        NA        NA         0         0         0        NA        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0
Age50_59                                          0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA         0         0        NA        NA        NA         0         0        NA        NA        NA         0         0        NA         0         0         0         0         0        NA         0         0        NA         0         0         0         0        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA         0         0        NA        NA        NA         0        NA        NA        NA        NA        NA         0        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA         0         0        NA        NA        NA         0         0        NA        NA         0         0         0        NA         0         0         0         0         0        NA         0         0        NA         0         0        NA         0        NA        NA         0         0        NA         0         0         0         0         0         0        NA         0         0        NA        NA        NA         0         0        NA        NA         0         0         0        NA         0         0         0        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA         0        NA         0         0        NA         0         0         0         0        NA        NA         0         0         0        NA         0         0         0        NA         0        NA        NA         0        NA        NA         0         0         0        NA        NA         0         0         0         0         0         0        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0     97800         0         0        NA        NA        NA         0         0        NA        NA         0         0         0        NA         0         0         0         0         0        NA         0         0        NA        NA        NA         0         0        NA        NA        NA        NA         0        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA         0         0        NA         0         0         0         0        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA         0         0        NA        NA        NA         0         0        NA        NA        NA        NA         0         0         0         0         0         0         0        NA         0         0        NA         0         0         0         0        NA        NA         0         0         0        NA         0         0         0         0         0        NA        NA         0        NA        NA        NA         0         0        NA        NA        NA        NA         0        NA        NA        NA         0         0         0        NA         0         0        NA         0         0         0         0        NA        NA         0         0         0         0         0         0         0         0         0        NA         0         0        NA         0         0         0         0         0        NA         0         0         0        NA         0         0         0         0         0        NA         0         0        NA         0         0        NA         0        NA        NA         0         0        NA        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0
Age60_69                                          0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA         0         0        NA        NA        NA         0         0        NA        NA        NA         0         0        NA         0         0         0         0         0        NA         0         0        NA         0         0         0         0        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA         0         0        NA        NA        NA         0        NA        NA        NA        NA        NA         0        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA         0         0        NA        NA        NA         0         0        NA        NA         0         0         0        NA         0         0         0         0         0        NA         0         0        NA         0         0        NA         0        NA        NA         0         0        NA         0         0         0         0         0         0        NA         0         0        NA        NA        NA         0         0        NA        NA         0         0         0        NA         0         0         0        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA         0        NA         0         0        NA         0         0         0         0        NA        NA         0         0         0        NA         0         0         0        NA         0        NA        NA         0        NA        NA         0         0         0        NA        NA         0         0         0         0         0         0        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0     97800         0         0        NA        NA        NA         0         0        NA        NA         0         0         0        NA         0         0         0         0         0        NA         0         0        NA        NA        NA         0         0        NA        NA        NA        NA         0        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA         0         0        NA         0         0         0         0        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA         0         0        NA        NA        NA         0         0        NA        NA        NA        NA         0         0         0         0         0         0         0        NA         0         0        NA         0         0         0         0        NA        NA         0         0         0        NA         0         0         0         0         0        NA        NA        NA        NA        NA        NA         0         0        NA        NA        NA        NA         0        NA        NA        NA         0         0         0        NA         0         0        NA         0         0         0         0        NA        NA         0         0         0         0         0         0         0         0         0        NA         0         0        NA         0         0         0         0         0        NA         0         0         0        NA         0         0         0         0         0        NA         0         0        NA         0         0        NA         0        NA        NA         0         0        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0
Age70_79                                          0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA         0         0        NA        NA        NA         0         0        NA        NA        NA         0         0        NA         0         0         0         0         0        NA         0         0        NA         0         0         0         0        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA         0         0        NA        NA        NA         0        NA        NA        NA        NA        NA         0        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA         0         0        NA        NA        NA         0         0        NA        NA         0         0         0        NA         0         0         0         0         0        NA         0         0        NA         0         0        NA         0        NA        NA         0         0        NA         0         0         0         0         0         0        NA         0         0        NA        NA        NA         0         0        NA        NA         0         0         0        NA         0         0         0        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA         0        NA         0         0        NA         0         0         0         0        NA        NA         0         0         0        NA         0         0         0        NA         0        NA        NA         0        NA        NA         0         0         0        NA        NA         0         0         0         0         0         0        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0     97800         0         0        NA        NA        NA         0         0        NA        NA         0         0         0        NA         0         0         0         0         0        NA         0         0        NA        NA        NA         0         0        NA        NA        NA        NA         0        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA         0         0        NA         0         0         0         0        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA         0         0        NA        NA        NA         0         0        NA        NA        NA        NA         0         0         0         0         0         0         0        NA         0         0        NA         0         0         0         0        NA        NA         0         0         0        NA         0         0         0         0         0        NA        NA        NA        NA        NA        NA         0         0        NA        NA        NA        NA         0        NA        NA        NA         0         0         0        NA         0         0        NA         0         0         0         0        NA        NA         0         0         0         0         0         0         0         0         0        NA         0         0        NA         0         0         0         0         0        NA         0         0         0        NA         0         0         0         0         0        NA         0         0        NA         0         0        NA         0        NA        NA         0         0        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0
Age80+                                            0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA         0         0        NA        NA        NA         0         0        NA        NA        NA         0         0        NA         0         0         0         0         0        NA         0         0        NA         0         0         0         0        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA         0         0        NA        NA        NA         0        NA        NA        NA        NA        NA         0        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA         0         0        NA        NA        NA         0         0        NA        NA         0         0         0        NA         0         0         0         0         0        NA         0         0        NA         0         0        NA         0        NA        NA         0         0        NA         0         0         0         0         0         0        NA         0         0        NA        NA        NA         0         0        NA        NA         0         0         0        NA         0         0         0        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA         0        NA         0         0        NA         0         0         0         0        NA        NA         0         0         0        NA         0         0         0        NA         0        NA        NA         0        NA        NA         0         0         0        NA        NA         0         0         0         0         0         0        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0     97800         0         0        NA        NA        NA         0         0        NA        NA         0         0         0        NA         0         0         0         0         0        NA         0         0        NA        NA        NA         0         0        NA        NA        NA        NA         0        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA         0         0        NA         0         0         0         0        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA         0         0        NA        NA        NA         0         0        NA        NA        NA        NA         0         0         0         0         0         0         0        NA         0         0        NA         0         0         0         0        NA        NA         0         0         0        NA         0         0         0         0         0        NA        NA        NA        NA        NA        NA         0         0        NA        NA        NA         0         0        NA        NA        NA         0         0         0        NA         0         0        NA         0         0         0         0        NA        NA         0         0         0         0         0         0         0         0         0        NA         0         0        NA         0         0         0         0         0        NA         0         0         0        NA         0         0         0         0         0        NA         0         0        NA         0         0        NA         0        NA        NA         0         0        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0
AgeUNK                                            0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA         0         0        NA        NA        NA         0         0        NA        NA        NA         0         0        NA         0         0         0         0         0        NA         0         0        NA         0         0         0         0        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA         0         0        NA        NA        NA         0         0        NA        NA         0         0         0        NA         0         0         0         0         0        NA         0         0        NA         0         0        NA         0        NA        NA         0         0        NA         0         0         0         0         0         0        NA         0         0        NA        NA        NA         0         0        NA        NA         0         0         0        NA         0         0         0        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA         0        NA         0         0        NA         0         0         0         0        NA        NA         0         0         0        NA         0         0         0        NA         0        NA        NA         0        NA        NA         0         0         0        NA        NA         0         0         0         0         0         0        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0     97800         0         0        NA        NA        NA         0         0        NA        NA         0         0         0        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA         0         0        NA         0         0         0         0        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA         0         0        NA         0         0         0         0        NA        NA         0         0         0        NA         0         0         0         0         0        NA        NA        NA        NA        NA        NA         0         0        NA        NA        NA         0         0         0         0        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0
ALL                                         5519600         0         0  24394773   1512000   5530560         0         0   1292400   5963500   2474610         0         0   3192000   2243300         0         0         0    151200        NA         0         0        NA        NA        NA         0         0        NA        NA        NA         0         0        NA         0         0         0         0         0        NA         0         0   7265580         0         0         0         0        NA        NA         0         0         0         0         0         0         0         0         0    432300         0         0   2033293         0     37440         0         0    190100    155200     24250      9500         0     90000         0         0         0         0         0   1628400         0         0  21204560   1321920   5135040         0     97920   1396200   3685100    199700     46750         0    578000     64800         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0 241419933         0    202920         0         0   7614360         0         0         0         0     42300   1350690         0         0         0         0         0         0         0         0         0    818300         0         0   2304060    279360    350400         0         0    120800    270400    192750     98400         0     60800         0         0         0         0         0   4035800         0         0  25348740    800640   1428480         0         0   2401800   1770000         0         0         0    396000         0         0         0         0         0        NA         0         0 100959011         0         0        NA         0        NA        NA         0         0        NA         0         0         0         0         0         0        NA         0         0        NA        NA        NA         0         0        NA        NA         0         0         0        NA         0         0         0        NA        NA  10355500         0         0 136804000         0  23481600         0         0   3732300  54929280   8321200   3315650         0   2965000  16576400         0         0        NA         0        NA         0         0        NA         0         0         0         0        NA        NA         0         0         0        NA         0         0         0        NA         0   6513800   5187056         0  13163840    216000         0         0         0   4309200   1736400         0         0         0         0         0         0   2000000         0         0   1442700         0         0  11135050         0         0         0         0    281500   3290500         0         0         0    198000         0         0         0         0         0    100880         0         0    794870    126720    100800         0         0     57500    261720     65350     98350         0     42000         0         0         0         0         0        NA         0         0        NA        NA        NA         0         0        NA        NA        NA        NA         0        NA        NA         0         0         0         0         0         0         0     22650         0         0         0         0       650     44500         0         0         0         0         0         0         0         0         0   1121594         0         0   6789378         0         0         0         0    653097    732830         0         0         0         0         0         0         0     10162         0    186600         0         0   1346640     86400    168000         0     18240     80250    302610    303240    243300         0    105000         0         0         0         0         0   1273400         0         0   3001755    460800   1088640         0         0   1259800   1171300    543980    123600         0    189600    108000         0         0         0         0        NA         0         0        NA         0         0         0         0        NA        NA         0         0         0         0         0         0         0         0         0   4503400         0         0  34003726   2871360   6325440         0         0   2464800  11327200   6175700         0         0    707000         0         0         0         0         0    578400         0         0  11373105    889920   2453760         0         0    403900   3982600   1443150   2271400         0         0         0         0         0         0         0        NA         0         0        NA         0         0         0         0        NA        NA         0         0         0        NA         0         0         0         0         0        NA        NA        NA        NA        NA        NA         0         0        NA        NA        NA        NA         0        NA        NA        NA         0         0         0   2999600         0         0  18276235         0         0         0         0   2820300   2805700         0         0         0         0         0         0         0         0         0        NA         0         0        NA         0         0         0         0         0        NA         0         0         0        NA         0         0         0         0         0   1123800         0         0   3987390         0         0    800640     58560    230400    714400         0         0    705400     94000    115200         0         0         0         0   1612810         0         0   7723560         0         0         0         0    475200    871200         0         0         0     93000         0         0    200000         0         0
HCW                                               0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA         0         0        NA        NA        NA         0         0        NA        NA        NA         0         0        NA         0         0         0         0         0        NA         0         0        NA         0         0         0         0        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA         0         0        NA        NA        NA         0        NA        NA        NA        NA        NA         0        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA         0         0        NA        NA        NA         0         0        NA        NA         0         0         0        NA         0         0         0         0         0        NA         0         0        NA         0         0        NA         0        NA        NA         0         0        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA         0         0        NA         0         0         0         0        NA        NA         0         0         0        NA         0         0         0        NA         0        NA        NA         0        NA         0         0         0         0        NA        NA         0         0         0         0         0         0        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0     97800         0         0        NA        NA        NA         0         0        NA        NA         0         0         0        NA         0         0         0         0         0        NA         0         0        NA        NA        NA         0         0        NA        NA        NA        NA         0        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA         0         0        NA         0         0         0         0        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA         0         0        NA        NA        NA         0         0        NA        NA        NA        NA         0         0         0         0         0         0         0        NA         0         0        NA         0         0         0         0        NA        NA         0         0         0        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA         0         0        NA         0         0         0         0        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA         0        NA         0         0        NA         0         0        NA         0        NA        NA         0         0        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0
LTCF                                              0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA         0         0        NA        NA        NA         0         0        NA        NA        NA         0         0        NA         0         0         0         0         0        NA         0         0        NA         0         0         0         0        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA         0         0        NA        NA        NA         0        NA        NA        NA        NA         0         0        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA         0        NA         0         0        NA         0         0         0         0         0         0         0         0         0         0        NA         0         0        NA         0         0        NA         0        NA        NA         0         0        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA         0         0        NA         0         0         0         0        NA        NA         0         0         0        NA         0         0         0        NA         0        NA        NA         0        NA         0         0         0         0        NA        NA         0         0         0         0         0         0        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0     97800         0         0        NA        NA        NA         0         0        NA        NA         0         0         0        NA         0         0         0         0         0        NA         0         0        NA        NA        NA         0         0        NA        NA        NA        NA         0        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA         0         0        NA         0         0         0         0        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA         0         0        NA         0         0         0         0        NA        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0        NA         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0         0
NA
NA
NA
NA
NA
--- Cropped output ---</code></pre>
</div>
</div>
<section id="quick-exercise-iii" class="level3">
<h3 class="anchored" data-anchor-id="quick-exercise-iii"><span style="color:darkseagreen">Quick exercise (III)</span></h3>
<p>Sometimes, it is better to use a shorter table as an example… Let’s go back to the <em>coli_genomes</em> data that you already know.</p>
<strong>Could you obtain a table like the following, with the number of Contigs by isolation source (<em>Source</em>) and phylogenetic group (<em>Phylogroup</em>)?</strong>
<div id="radio_LBBCGYEHYM" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_LBBCGYEHYM" value=""> <span>with(coli_genomes, table(Source, Phylogroup))</span></label><label><input type="radio" autocomplete="off" name="radio_LBBCGYEHYM" value="answer"> <span>xtabs(Contigs ~ Source + Phylogroup, coli_genomes)</span></label><label><input type="radio" autocomplete="off" name="radio_LBBCGYEHYM" value=""> <span>xtabs( ~ Contigs + Source + Phylogroup, coli_genomes)</span></label>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>         Phylogroup
Source       A   B1    C    D
  Avian    134  102  108    0
  Human    790  208  662 1010
  Porcine  958    0    0    0</code></pre>
</div>
</div>
<p>Now, let’s do it a little bit more complicated. If we split the previous table by the STs (aka. multilocus sequence typing), you obtain a very large table:</p>
<div class="cell" data-output.lines="[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50]">
<div class="cell-output cell-output-stdout">
<pre><code>, , Sequence.Type = ST10

         Phylogroup
Source      A  B1   C   D
  Avian     0   0   0   0
  Human   120   0   0   0
  Porcine 277   0   0   0

, , Sequence.Type = ST1049

         Phylogroup
Source      A  B1   C   D
  Avian     0   0   0   0
  Human     0  94   0   0
  Porcine   0   0   0   0

, , Sequence.Type = ST10888

         Phylogroup
Source      A  B1   C   D
  Avian     0   0   0   0
  Human     0   0   0   0
  Porcine 203   0   0   0

, , Sequence.Type = ST10890

         Phylogroup
Source      A  B1   C   D
  Avian     0   0   0   0
  Human     0   0 171   0
  Porcine   0   0   0   0

, , Sequence.Type = ST137

         Phylogroup
Source      A  B1   C   D
  Avian     0   0   0   0
  Human     0   0   0 205
  Porcine   0   0   0   0

, , Sequence.Type = ST156

         Phylogroup
Source      A  B1   C   D
  Avian     0   0   0   0
  Human     0 114   0   0
  Porcine   0   0   0   0

, , Sequence.Type = ST3011

--- Cropped output ---</code></pre>
</div>
</div>
<p>This is quite a long cross-table that we have cropped on the output, maybe you could find more convenient transforming it to a flat contingency table with <code>ftable()</code>.</p>
<strong>How would you generate a flat table using the previous cross-tabulated table?</strong>
<div id="radio_EZHMPNYSFP" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_EZHMPNYSFP" value=""> <span>ftable(coli_xgenomes)</span></label><label><input type="radio" autocomplete="off" name="radio_EZHMPNYSFP" value=""> <span>ftable(coli_xgenomes, col.vars=1</span></label><label><input type="radio" autocomplete="off" name="radio_EZHMPNYSFP" value="answer"> <span>ftable(coli_xgenomes, row.vars=3</span></label><label><input type="radio" autocomplete="off" name="radio_EZHMPNYSFP" value="answer"> <span>ftable(coli_xgenomes, col.vars=c(1,2)</span></label>
</div>
<p>If you test the different options, you will notice that the format of the table can be defined by the order of the variables and also using the arguments <code>row.vars</code> and <code>col.vars</code> to define which variables will be summarized as column or row.</p>
<p>Again, rather than concepts from R or RStudio, cross-tabulation and flat contingency tables are general concepts in data analysis.</p>
</section>
</section>
</section>
<section id="data-aggregation-and-transformation" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Data aggregation and transformation</h1>
<section id="by-aggregate" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="by-aggregate"><span class="header-section-number">3.1</span> By() &amp; aggregate()</h2>
<p>While frequency tables can be very quickly generated with <code>table()</code> and <code>xtable()</code>, sometimes you may want other calculations than frequency, like basic statistics per group or other, even custom, calculations.</p>
<p>You have already tried the function <code>by()</code> as a very useful trick to make group-calculations. However, this function has some limitations when we have large datasets and when we try to use multiple factors that can be solved with <code>aggregate()</code>. In both cases, the function can be any function that suits your data, either from R packages or a custom function.</p>
<p>In the following example, we are using a smaller dataset named <em>vacines2</em> that we can obtain by <em>sampling</em> (randomly extraction of a portion of data) with the R function <code>sample()</code>.</p>
<div class="cell" data-output.lines="[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25]">
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a>vaccines2 <span class="ot">&lt;-</span> vaccines[<span class="fu">sample</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(vaccines),<span class="at">size =</span> <span class="dv">50000</span>, <span class="at">replace=</span><span class="cn">FALSE</span>),]</span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-3"><a href="#cb138-3" aria-hidden="true" tabindex="-1"></a><span class="co">#using by()</span></span>
<span id="cb138-4"><a href="#cb138-4" aria-hidden="true" tabindex="-1"></a><span class="fu">by</span>(vaccines2<span class="sc">$</span>NumberDosesReceived, <span class="at">INDICES =</span> vaccines2<span class="sc">$</span>Region, <span class="at">FUN=</span>mean, <span class="at">na.rm=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>vaccines2$Region: AT
[1] 863.1548
------------------------------------------------------------ 
vaccines2$Region: BE
[1] 84981.43
------------------------------------------------------------ 
vaccines2$Region: BG
[1] 8271.774
------------------------------------------------------------ 
vaccines2$Region: CY
[1] 444.4356
------------------------------------------------------------ 
vaccines2$Region: CZ
[1] 23633.5
------------------------------------------------------------ 
vaccines2$Region: DE
[1] 1187927
------------------------------------------------------------ 
vaccines2$Region: DK
[1] 1673.99
------------------------------------------------------------ 
vaccines2$Region: EE
[1] 411.1807
------------------------------------------------------------ 
vaccines2$Region: EL
--- Cropped output ---</code></pre>
</div>
</div>
<p>In the example above, we could calculate the mean by groups. Can we do it with more than one grouping factor? Let’s try some alternatives and see the output</p>
<div class="cell" data-output.lines="[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25]">
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="fu">by</span>(vaccines2<span class="sc">$</span>NumberDosesReceived, <span class="at">INDICES =</span> vaccines2<span class="sc">$</span>Region <span class="sc">+</span> vaccines2<span class="sc">$</span>Vaccine, <span class="at">FUN=</span>mean, <span class="at">na.rm=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in vaccines2$Region + vaccines2$Vaccine: non-numeric argument to binary operator</code></pre>
</div>
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="fu">by</span>(vaccines2<span class="sc">$</span>NumberDosesReceived, <span class="at">INDICES =</span> <span class="fu">c</span>(vaccines2<span class="sc">$</span>Region,vaccines2<span class="sc">$</span>Vaccine), <span class="at">FUN=</span>mean, <span class="at">na.rm=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in tapply(seq_len(50000L), list(`c(vaccines2$Region, vaccines2$Vaccine)` = c("LU", : arguments must have same length</code></pre>
</div>
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="fu">by</span>(vaccines2<span class="sc">$</span>NumberDosesReceived, <span class="at">INDICES =</span> <span class="fu">list</span>(vaccines2<span class="sc">$</span>Region,vaccines2<span class="sc">$</span>Vaccine), <span class="at">FUN=</span>mean, <span class="at">na.rm=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>: AT
: AZ
[1] 0
------------------------------------------------------------ 
: BE
: AZ
[1] 12960
------------------------------------------------------------ 
: BG
: AZ
[1] 4560
------------------------------------------------------------ 
: CY
: AZ
[1] 1521.127
------------------------------------------------------------ 
: CZ
: AZ
[1] 7800
------------------------------------------------------------ 
: DE
: AZ
[1] NA
------------------------------------------------------------ 
: DK
--- Cropped output ---</code></pre>
</div>
</div>
<p>When you find difficult using <code>by()</code>, <code>aggregate()</code> is usually the best quick alternative</p>
<div class="cell" data-output.lines="[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]">
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="co">#aggregate is more convenient sometimes</span></span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a><span class="fu">aggregate</span>(vaccines2<span class="sc">$</span>NumberDosesReceived <span class="sc">~</span> vaccines2<span class="sc">$</span>Region, <span class="at">FUN=</span>mean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   vaccines2$Region vaccines2$NumberDosesReceived
1                AT                  8.631548e+02
2                BE                  8.498143e+04
3                BG                  8.271774e+03
4                CY                  4.444356e+02
5                CZ                  2.363350e+04
6                DE                  1.187927e+06
7                DK                  1.673990e+03
8                EE                  4.111807e+02
9                EL                  1.062098e+05
10               ES                  1.107086e+05
11               FI                  1.231633e+05
12               FR                  2.334438e+05
13               HR                  8.978824e+04
14               HU                  4.790211e+04
--- Cropped output ---</code></pre>
</div>
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="fu">aggregate</span>(NumberDosesReceived <span class="sc">~</span> Region<span class="sc">+</span>Vaccine, <span class="at">data=</span>vaccines2, <span class="at">FUN=</span>mean) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    Region   Vaccine NumberDosesReceived
1       AT        AZ        0.000000e+00
2       BE        AZ        1.296000e+04
3       BG        AZ        4.560000e+03
4       CY        AZ        1.521127e+03
5       CZ        AZ        7.800000e+03
6       DK        AZ        0.000000e+00
7       EE        AZ        5.014925e+02
8       EL        AZ        2.596250e+04
9       ES        AZ        0.000000e+00
10      FR        AZ        1.847273e+05
11      HR        AZ        1.924500e+05
12      HU        AZ        1.371667e+05
13      IE        AZ        3.058824e+03
14      IS        AZ        2.705263e+03
--- Cropped output ---</code></pre>
</div>
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="fu">aggregate</span>(FirstDoseRefused <span class="sc">~</span> TargetGroup, <span class="at">data=</span>vaccines2, <span class="at">FUN=</span>median) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   TargetGroup FirstDoseRefused
1     1_Age&lt;60                0
2     1_Age60+                0
3       Age&lt;18                0
4     Age18_24                0
5     Age25_49                0
6     Age50_59                0
7     Age60_69                0
8     Age70_79                0
9       Age80+                0
10      AgeUNK                0
11         ALL                0
12         HCW                0
13        LTCF                0
NA
--- Cropped output ---</code></pre>
</div>
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a><span class="co">#note that by default NAs are disregarded</span></span>
<span id="cb152-2"><a href="#cb152-2" aria-hidden="true" tabindex="-1"></a><span class="fu">aggregate</span>(FirstDoseRefused <span class="sc">~</span> TargetGroup, <span class="at">data=</span>vaccines2, <span class="at">na.action =</span> <span class="cn">NULL</span>, <span class="at">FUN=</span>median) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   TargetGroup FirstDoseRefused
1     1_Age&lt;60               NA
2     1_Age60+               NA
3       Age&lt;18               NA
4       Age0_4               NA
5     Age10_14               NA
6     Age15_17               NA
7     Age18_24               NA
8     Age25_49               NA
9       Age5_9               NA
10    Age50_59               NA
11    Age60_69               NA
12    Age70_79               NA
13      Age80+               NA
14      AgeUNK               NA
--- Cropped output ---</code></pre>
</div>
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a><span class="co">#we can make it for several numeric variables at the same time</span></span>
<span id="cb154-2"><a href="#cb154-2" aria-hidden="true" tabindex="-1"></a><span class="fu">aggregate</span>(<span class="fu">cbind</span>(NumberDosesReceived,FirstDose,SecondDose) <span class="sc">~</span> <span class="fu">as.factor</span>(TargetGroup), <span class="at">data=</span>vaccines2, <span class="at">FUN=</span>mean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   as.factor(TargetGroup) NumberDosesReceived    FirstDose   SecondDose
1                  Age&lt;18             0.00000   255.485714   372.703571
2                  Age0_4           337.76371     3.046414     1.886076
3                Age10_14           106.71916    70.619423   122.102362
4                Age15_17           169.72299   217.531856   470.218837
5                Age18_24            60.16097   205.907445   448.239437
6                Age25_49           116.11111  1200.955197   666.951613
7                  Age5_9            48.64353    22.823344    36.845426
8                Age50_59           168.61004   756.042471   917.851351
9                Age60_69            90.75581   811.125969   419.263566
10               Age70_79           211.23260   282.898608   884.852883
11                 Age80+            95.97656   401.140625   431.812500
12                 AgeUNK           162.27273     2.515152     2.530303
13                    ALL         65872.93241 13850.593702 14767.386329
14                    HCW           208.10811   129.211712    72.238739
--- Cropped output ---</code></pre>
</div>
</div>
<p>We can also add a custom function, using the short, usually with the inline notation:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a><span class="co">#we can also use custom functions here</span></span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a><span class="fu">aggregate</span>(<span class="fu">cbind</span>(FirstDose,SecondDose) <span class="sc">~</span> <span class="fu">as.factor</span>(TargetGroup), <span class="at">data=</span>vaccines2, <span class="at">FUN=</span><span class="cf">function</span>(x) <span class="fu">mean</span>(x)<span class="sc">*</span><span class="dv">100</span><span class="sc">/</span><span class="fu">mean</span>(vaccines2<span class="sc">$</span>NumberDosesReceived, <span class="at">na.rm=</span><span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   as.factor(TargetGroup)    FirstDose   SecondDose
1                1_Age&lt;60 2.361426e+02 131.61576716
2                1_Age60+ 5.637368e+01  91.38596497
3                  Age&lt;18 3.632995e+00   2.62276497
4                  Age0_4 4.162515e-03   0.00266401
5                Age10_14 1.056957e+00   0.81482493
6                Age15_17 5.015793e-01   0.63640663
7                Age18_24 2.029884e+00   2.30012294
8                Age25_49 1.436895e+01  12.76458287
9                  Age5_9 2.343904e-01   0.12675028
10               Age50_59 6.201552e+00   6.46452674
11               Age60_69 7.154872e+00   5.84655809
12               Age70_79 4.439182e+00   4.91053813
13                 Age80+ 2.603657e+00   2.38937302
14                 AgeUNK 6.516587e-02   0.03123223
15                    ALL 3.853549e+01  38.75315384
16                    HCW 1.519506e+00   1.29285996
17                   LTCF 6.273873e-01   1.26261413</code></pre>
</div>
</div>
<section id="quick-exercise-iv" class="level3">
<h3 class="anchored" data-anchor-id="quick-exercise-iv"><span style="color:darkseagreen">Quick exercise (IV)</span></h3>
<p>We are using again the <em>coli_genomes</em> dataframe.</p>
<strong>Can you obtain the following table displaying the mean (%) of virulece factors (VF) and plasmids per genome nucleotide (Assembly_length) grouped by Source</strong>
<div id="radio_FDQUKHSCQN" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_FDQUKHSCQN" value=""> <span>aggregate(cbind(VF,Plasmids) ~ Source, data=coli_genomes, FUN=mean)</span></label><label><input type="radio" autocomplete="off" name="radio_FDQUKHSCQN" value=""> <span>aggregate(cbind(VF,Plasmids) ~ Source, data=coli_genomes, FUN=function(x) mean(x) * 100 / mean(Assembly_length))</span></label><label><input type="radio" autocomplete="off" name="radio_FDQUKHSCQN" value="answer"> <span>aggregate(cbind(VF,Plasmids) ~ Source, data=coli_genomes, FUN=function(x) mean(x) * 100 / mean(coli_genomes$Assembly_length))</span></label>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>   Source           VF     Plasmids
1   Avian 1.455256e-04 5.291842e-05
2   Human 2.235803e-04 5.291842e-05
3 Porcine 8.929983e-05 1.289886e-04</code></pre>
</div>
</div>
</section>
</section>
<section id="apply-family-of-functions" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="apply-family-of-functions"><span class="header-section-number">3.2</span> Apply family of functions</h2>
<div style="float: left; position: relative; top: 0px; padding: 3px;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="https://www.r-bloggers.com/2016/03/apply-lapply-rapply-sapply-functions-in-r-2/"><img src="images/apply_family-01.jpg" class="img-fluid figure-img" width="428" alt="Apply family of functions"></a></p>
<figcaption>Apply family of functions</figcaption>
</figure>
</div>
</div>
<p>The functions of the <strong>Apply</strong> family are designed to apply a function to each element of a data structure. It includes various functions, designed for matrices, dataframes or lists. What is special about these functions is that their arguments are not only data but also functions. Using an <strong>apply</strong> function can sometimes seem complicated, but once you get used to it, it’s actually very handy and faster than other alternatives, such as loops. In this section, we look at the <code>apply()</code> function and its variants, including <code>lapply()</code>, <code>sapply()</code>, <code>tapply()</code>, <code>rapply()</code> &amp; <code>mapply()</code>. In general, <strong>Apply</strong> is a very efficient tool to perform repetitive calculations.</p>
<p>Rather than describing in detail all the functions, in the following examples we test some of the possibilities of some <em>applies</em>. Try yourself and check the code comments.</p>
<div class="cell" data-output.lines="[1,2,3,4,5,6]">
<div class="sourceCode cell-code" id="cb159"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a><span class="co">#apply()</span></span>
<span id="cb159-2"><a href="#cb159-2" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(vaccines[,<span class="dv">4</span><span class="sc">:</span><span class="dv">12</span>], <span class="at">MARGIN =</span> <span class="dv">1</span>, <span class="at">FUN =</span> mean, <span class="at">na.rm=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    [1] 0.000000e+00 0.000000e+00 3.000000e+00 0.000000e+00 5.000000e-01
    [6] 6.250000e-01 6.250000e-01 5.000000e-01 0.000000e+00 6.250000e-01
   [11] 1.250000e-01 0.000000e+00 0.000000e+00 0.000000e+00 0.000000e+00
   [16] 0.000000e+00 0.000000e+00 0.000000e+00 0.000000e+00 0.000000e+00
   [21] 0.000000e+00 0.000000e+00 0.000000e+00 0.000000e+00 0.000000e+00
   [26] 0.000000e+00 8.887500e+01 3.750000e+00 1.325000e+01 1.862500e+01
--- Cropped output ---</code></pre>
</div>
<div class="sourceCode cell-code" id="cb161"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(vaccines[,<span class="dv">4</span><span class="sc">:</span><span class="dv">12</span>], <span class="dv">2</span>, mean, <span class="at">na.rm=</span><span class="cn">TRUE</span>) <span class="co"># 1 for row-wise operation, 2 for column-wise</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>NumberDosesReceived NumberDosesExported           FirstDose    FirstDoseRefused 
       1.400034e+04        8.621084e+02        1.147629e+03        4.015204e-01 
         SecondDose     DoseAdditional1     DoseAdditional2     DoseAdditional3 
       1.044477e+03        8.282688e+02        2.215100e+02        3.164597e+01 
    DoseAdditional4 
       4.815256e-01 
--- Cropped output ---</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb163"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(vaccines, <span class="dv">2</span>, is.numeric)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        YearWeekISO    ReportingCountry         Denominator NumberDosesReceived 
              FALSE               FALSE               FALSE               FALSE 
NumberDosesExported           FirstDose    FirstDoseRefused          SecondDose 
              FALSE               FALSE               FALSE               FALSE 
    DoseAdditional1     DoseAdditional2     DoseAdditional3     DoseAdditional4 
              FALSE               FALSE               FALSE               FALSE 
    DoseAdditional5         UnknownDose              Region         TargetGroup 
              FALSE               FALSE               FALSE               FALSE 
            Vaccine          Population 
              FALSE               FALSE </code></pre>
</div>
<div class="sourceCode cell-code" id="cb165"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(vaccines[,<span class="dv">3</span><span class="sc">:</span><span class="dv">6</span>], <span class="dv">2</span>, is.numeric)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Denominator NumberDosesReceived NumberDosesExported           FirstDose 
               TRUE                TRUE                TRUE                TRUE </code></pre>
</div>
</div>
<p>Note that you can use any function, although <code>apply()</code>is best suited for numeric calculations as it coerces your data to an array (via <code>as.matrix()</code>). Thus, when a dataframe cannot be transformed in a matrix your function may return fail. In the example above <code>is.numeric()</code> returns false for all columns within the apply when the dataframe contains character data, but if we use a subset that only contains numeric data the result makes sense. As you can see below, <code>sapply()</code> and <code>lapply()</code> are best suited for this kind of functions.</p>
<div class="cell" data-output.lines="[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25]">
<div class="sourceCode cell-code" id="cb167"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a><span class="co">#lapply() and sapply() are very useful</span></span>
<span id="cb167-2"><a href="#cb167-2" aria-hidden="true" tabindex="-1"></a><span class="fu">lapply</span>(<span class="fu">by</span>(vaccines<span class="sc">$</span>Population,vaccines<span class="sc">$</span>ReportingCountry,mean), log10) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$AT
[1] 6.952307

$BE
[1] 7.064378

$BG
[1] 6.836669

$CY
[1] 5.955408

$CZ
[1] 7.021618

$DE
[1] 7.920154

$DK
[1] 6.767897

$EE
[1] 6.124304

$EL
--- Cropped output ---</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb169"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(<span class="fu">by</span>(vaccines<span class="sc">$</span>Population,vaccines<span class="sc">$</span>ReportingCountry,mean), log10) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      AT       BE       BG       CY       CZ       DE       DK       EE 
6.952307 7.064378 6.836669 5.955408 7.021618 7.920154 6.767897 6.124304 
      EL       ES       FI       FR       HR       HU       IE       IS 
7.022918 7.675960 6.743725 7.831098 6.594992 6.987135 6.702566 5.571271 
      IT       LI       LT       LU       LV       MT       NL       NO 
7.771600 4.593620 6.447600 5.808232 6.274627 5.715350 7.244198 6.733418 
      PL       PT       RO       SE       SI       SK 
7.576630 7.014051 7.280790 7.018045 6.323863 6.736098 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb171"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(<span class="fu">lapply</span>(<span class="fu">by</span>(vaccines<span class="sc">$</span>Population,vaccines<span class="sc">$</span>ReportingCountry,mean), log10) ) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "list"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb173"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a><span class="co">#lapply take a list (or object that can be coerced as one) and gives a list</span></span>
<span id="cb173-2"><a href="#cb173-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(<span class="fu">sapply</span>(<span class="fu">by</span>(vaccines<span class="sc">$</span>Population,vaccines<span class="sc">$</span>ReportingCountry,mean), log10) ) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "numeric"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb175"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb175-1"><a href="#cb175-1" aria-hidden="true" tabindex="-1"></a><span class="co">#sapply is actually a 'wrapper' of lapply that returns a vector or matrix instead of a list</span></span>
<span id="cb175-2"><a href="#cb175-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-3"><a href="#cb175-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-4"><a href="#cb175-4" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(<span class="fu">list</span>(vaccines2<span class="sc">$</span>Population, vaccines2<span class="sc">$</span>FirstDose,vaccines2<span class="sc">$</span>SecondDose, vaccines2<span class="sc">$</span>NumberDosesReceived), median) <span class="co"># we can do it with several variables</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5548241       0       0      NA</code></pre>
</div>
<div class="sourceCode cell-code" id="cb177"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb177-1"><a href="#cb177-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(vaccines2,class) <span class="co">#again, you can use any function, not only numeric calculations</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        YearWeekISO    ReportingCountry         Denominator NumberDosesReceived 
        "character"         "character"           "integer"           "integer" 
NumberDosesExported           FirstDose    FirstDoseRefused          SecondDose 
          "integer"           "integer"           "integer"           "integer" 
    DoseAdditional1     DoseAdditional2     DoseAdditional3     DoseAdditional4 
          "integer"           "integer"           "integer"           "integer" 
    DoseAdditional5         UnknownDose              Region         TargetGroup 
          "integer"           "integer"         "character"         "character" 
            Vaccine          Population 
        "character"           "integer" </code></pre>
</div>
<div class="sourceCode cell-code" id="cb179"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb179-1"><a href="#cb179-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(vaccines2, is.numeric) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        YearWeekISO    ReportingCountry         Denominator NumberDosesReceived 
              FALSE               FALSE                TRUE                TRUE 
NumberDosesExported           FirstDose    FirstDoseRefused          SecondDose 
               TRUE                TRUE                TRUE                TRUE 
    DoseAdditional1     DoseAdditional2     DoseAdditional3     DoseAdditional4 
               TRUE                TRUE                TRUE                TRUE 
    DoseAdditional5         UnknownDose              Region         TargetGroup 
               TRUE                TRUE               FALSE               FALSE 
            Vaccine          Population 
              FALSE                TRUE </code></pre>
</div>
</div>
<div class="cell" data-output.lines="[1,2,3,4,5,6,7,8,9,10]">
<div class="sourceCode cell-code" id="cb181"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a><span class="co">#other apply functions are more case-specific:</span></span>
<span id="cb181-2"><a href="#cb181-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-3"><a href="#cb181-3" aria-hidden="true" tabindex="-1"></a><span class="co">#mapply() is the matrix (or multivariable) version</span></span>
<span id="cb181-4"><a href="#cb181-4" aria-hidden="true" tabindex="-1"></a><span class="fu">mapply</span>(sub,vaccines2[,<span class="dv">4</span>],vaccines2[,<span class="dv">6</span>],vaccines2[,<span class="dv">7</span>]) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in (function (pattern, replacement, x, ignore.case = FALSE, perl =
FALSE, : argument 'pattern' has length &gt; 1 and only the first element will be
used</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in (function (pattern, replacement, x, ignore.case = FALSE, perl =
FALSE, : argument 'replacement' has length &gt; 1 and only the first element will
be used</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>         NumberDosesReceived
    [1,] NA                 
    [2,] NA                 
    [3,] NA                 
    [4,] NA                 
    [5,] NA                 
    [6,] NA                 
    [7,] NA                 
    [8,] NA                 
    [9,] NA                 
--- Cropped output ---</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb185"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mapply</span>(rep, letters[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>], <span class="dv">4</span><span class="sc">:</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$a
[1] "a" "a" "a" "a"

$b
[1] "b" "b" "b"

$c
[1] "c" "c"

$d
[1] "d"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb187"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a><span class="co">#tapply() breaks a vector into pieces, can be used instead of aggregate</span></span>
<span id="cb187-2"><a href="#cb187-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tapply</span>(vaccines<span class="sc">$</span>NumberDosesReceived, vaccines<span class="sc">$</span>ReportingCountry, median,<span class="at">na.rm=</span><span class="cn">TRUE</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    AT     BE     BG     CY     CZ     DE     DK     EE     EL     ES     FI 
     0      0      0      0      0 842400      0      0      0      0  91875 
    FR     HR     HU     IE     IS     IT     LI     LT     LU     LV     MT 
     0  34800      0      0      0      0      0      0      0      0     NA 
    NL     NO     PL     PT     RO     SE     SI     SK 
     0      0      0      0      0      0      0      0 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb189"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tapply</span>(coli_genomes<span class="sc">$</span>VF, coli_genomes<span class="sc">$</span>Source, mean, <span class="at">na.rm=</span><span class="cn">TRUE</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    Avian     Human   Porcine 
 7.333333 11.266667  4.500000 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb191"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a><span class="co">#vapply() is similar to sapply(), but has a pre-specified type of return value</span></span>
<span id="cb191-2"><a href="#cb191-2" aria-hidden="true" tabindex="-1"></a><span class="fu">vapply</span>(vaccines[,<span class="dv">8</span><span class="sc">:</span><span class="dv">11</span>],mean,<span class="fu">numeric</span>(<span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     SecondDose DoseAdditional1 DoseAdditional2 DoseAdditional3 
     1044.47747       828.26878       221.51000        31.64597 </code></pre>
</div>
</div>
<div class="cell" data-output.lines="[1,2,3,4,5,6,7,8,9,10]">
<div class="sourceCode cell-code" id="cb193"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb193-1"><a href="#cb193-1" aria-hidden="true" tabindex="-1"></a><span class="fu">vapply</span>(vaccines[,<span class="dv">8</span><span class="sc">:</span><span class="dv">11</span>],<span class="cf">function</span>(x) x<span class="sc">^</span><span class="dv">2</span>,<span class="fu">numeric</span>(<span class="fu">nrow</span>(vaccines)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            SecondDose DoseAdditional1 DoseAdditional2 DoseAdditional3
     [1,] 0.000000e+00    0.000000e+00    0.000000e+00               0
     [2,] 0.000000e+00    0.000000e+00    0.000000e+00               0
     [3,] 0.000000e+00    1.000000e+00    8.100000e+01             169
     [4,] 0.000000e+00    0.000000e+00    0.000000e+00               0
     [5,] 0.000000e+00    0.000000e+00    1.000000e+00               9
     [6,] 0.000000e+00    0.000000e+00    1.000000e+00              16
     [7,] 0.000000e+00    0.000000e+00    9.000000e+00               4
     [8,] 0.000000e+00    0.000000e+00    1.000000e+00               9
     [9,] 0.000000e+00    0.000000e+00    0.000000e+00               0
--- Cropped output ---</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb195"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb195-1"><a href="#cb195-1" aria-hidden="true" tabindex="-1"></a><span class="co">#rapply can be a handy trick for recursive calculations</span></span>
<span id="cb195-2"><a href="#cb195-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rapply</span>(vaccines, mean, <span class="at">class=</span><span class="st">"integer"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Denominator NumberDosesReceived NumberDosesExported           FirstDose 
                 NA                  NA                  NA        1.147629e+03 
   FirstDoseRefused          SecondDose     DoseAdditional1     DoseAdditional2 
                 NA        1.044477e+03        8.282688e+02        2.215100e+02 
    DoseAdditional3     DoseAdditional4     DoseAdditional5         UnknownDose 
       3.164597e+01        4.815256e-01        4.917829e-06        9.610626e+00 
         Population 
       1.584276e+07 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb197"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb197-1"><a href="#cb197-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rapply</span>(vaccines, table, <span class="at">class=</span><span class="st">"factor"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>NULL</code></pre>
</div>
</div>
<div class="cell" data-output.lines="[1,2,3,4,5,6,7,8,9,10]">
<div class="sourceCode cell-code" id="cb199"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb199-1"><a href="#cb199-1" aria-hidden="true" tabindex="-1"></a>vaccines<span class="sc">$</span>ReportingCountry<span class="ot">&lt;-</span><span class="fu">as.factor</span>(vaccines<span class="sc">$</span>ReportingCountry)</span>
<span id="cb199-2"><a href="#cb199-2" aria-hidden="true" tabindex="-1"></a>vaccines<span class="sc">$</span>Vaccine<span class="ot">&lt;-</span><span class="fu">as.factor</span>(vaccines<span class="sc">$</span>Vaccine)</span>
<span id="cb199-3"><a href="#cb199-3" aria-hidden="true" tabindex="-1"></a>vaccines<span class="sc">$</span>TargetGroup<span class="ot">&lt;-</span><span class="fu">as.factor</span>(vaccines<span class="sc">$</span>TargetGroup)</span>
<span id="cb199-4"><a href="#cb199-4" aria-hidden="true" tabindex="-1"></a>vaccines<span class="sc">$</span>Region<span class="ot">&lt;-</span><span class="fu">as.factor</span>(vaccines<span class="sc">$</span>Region)</span>
<span id="cb199-5"><a href="#cb199-5" aria-hidden="true" tabindex="-1"></a><span class="fu">rapply</span>(vaccines, table, <span class="at">class=</span><span class="st">"factor"</span>) <span class="co">#factors need to be defined and now it gives the counts for each group of each factor</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> ReportingCountry.AT  ReportingCountry.BE  ReportingCountry.BG 
               17292                 7330                 6001 
 ReportingCountry.CY  ReportingCountry.CZ  ReportingCountry.DE 
                7098                 6593                  564 
 ReportingCountry.DK  ReportingCountry.EE  ReportingCountry.EL 
                4821                 7755                16413 
 ReportingCountry.ES  ReportingCountry.FI  ReportingCountry.FR 
               12960               407160                22743 
 ReportingCountry.HR  ReportingCountry.HU  ReportingCountry.IE 
                9270                 6712                 6367 
--- Cropped output ---</code></pre>
</div>
<div class="sourceCode cell-code" id="cb201"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb201-1"><a href="#cb201-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rapply</span>(vaccines, median, <span class="at">how=</span><span class="st">"list"</span>, <span class="at">class=</span><span class="st">"integer"</span>, <span class="at">na.rm=</span><span class="cn">TRUE</span>) <span class="co">#returns a list</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$YearWeekISO
NULL

$ReportingCountry
NULL

$Denominator
[1] 272851

$NumberDosesReceived
--- Cropped output ---</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb203"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb203-1"><a href="#cb203-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rapply</span>(vaccines, median,  <span class="at">how=</span><span class="st">"unlist"</span>,<span class="at">class=</span><span class="st">"integer"</span>, <span class="at">na.rm=</span><span class="cn">TRUE</span>) <span class="co">#gives a vector</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Denominator NumberDosesReceived NumberDosesExported           FirstDose 
             272851                   0                   0                   0 
   FirstDoseRefused          SecondDose     DoseAdditional1     DoseAdditional2 
                  0                   0                   0                   0 
    DoseAdditional3     DoseAdditional4     DoseAdditional5         UnknownDose 
                  0                   0                   0                   0 
         Population 
            5548241 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb205"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb205-1"><a href="#cb205-1" aria-hidden="true" tabindex="-1"></a><span class="co">#what do you mean by RECURSIVELY?</span></span>
<span id="cb205-2"><a href="#cb205-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"a"</span>,<span class="fu">list</span>(<span class="dv">24</span>,<span class="dv">443</span>),<span class="dv">434</span>,<span class="fu">list</span>(<span class="dv">54</span>,<span class="fu">list</span>(<span class="dv">6443</span>,<span class="dv">7234</span>))) <span class="co">#this is a complex list with sublists</span></span>
<span id="cb205-3"><a href="#cb205-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-4"><a href="#cb205-4" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 4
 $ : chr "a"
 $ :List of 2
  ..$ : num 24
  ..$ : num 443
 $ : num 434
 $ :List of 2
  ..$ : num 54
  ..$ :List of 2
  .. ..$ : num 6443
  .. ..$ : num 7234</code></pre>
</div>
<div class="sourceCode cell-code" id="cb207"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb207-1"><a href="#cb207-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rapply</span>(x,log2,<span class="at">class=</span><span class="fu">c</span>(<span class="st">"numeric"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  4.584963  8.791163  8.761551  5.754888 12.653517 12.820578</code></pre>
</div>
<div class="sourceCode cell-code" id="cb209"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb209-1"><a href="#cb209-1" aria-hidden="true" tabindex="-1"></a>(r <span class="ot">&lt;-</span> <span class="fu">rapply</span>(x,log2,<span class="at">class=</span><span class="fu">c</span>(<span class="st">"numeric"</span>), <span class="at">how=</span><span class="st">"unlist"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  4.584963  8.791163  8.761551  5.754888 12.653517 12.820578</code></pre>
</div>
<div class="sourceCode cell-code" id="cb211"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb211-1"><a href="#cb211-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(r)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> num [1:6] 4.58 8.79 8.76 5.75 12.65 ...</code></pre>
</div>
</div>
<p>Note that <code>tapply()</code> and <code>by()</code> are very similar. Indeed, <code>by()</code> is a wrapper of <code>tapply()</code>. On the other hand, <code>vapply()</code> is similar to <code>sapply</code>, but has a pre-specified type of return value, so it can be safer (or faster) to use sometimes. Finally, <code>rapply()</code> is not very often used, but it can be the best option for complex datasets, like those including nested lists or complex lists with several dataframes and/or vectors.</p>
<p>The applications of <em>apply</em> functions are very wide, particularly the <code>apply()</code> and <code>lapply()</code>. You can use them to parse data with many different input and output structures and almost any kind of R functions, including plots (see Lesson R8).</p>
<section id="quick-exercise-v" class="level3">
<h3 class="anchored" data-anchor-id="quick-exercise-v"><span style="color:darkseagreen">Quick exercise (V)</span></h3>
<p>Of course, based on the <em>coli_genomes</em> dataframe.</p>
<strong>How would you obtain log10 of the mean of all the columns?</strong>
<div id="radio_ANLROQIPIH" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_ANLROQIPIH" value=""> <span>apply(coli_genomes,2,log10(mean), na.rm=TRUE)</span></label><label><input type="radio" autocomplete="off" name="radio_ANLROQIPIH" value=""> <span>apply(coli_genomes,1,log10(mean), na.rm=TRUE)</span></label><label><input type="radio" autocomplete="off" name="radio_ANLROQIPIH" value=""> <span>lapply(coli_genomes,log10(mean), na.rm=TRUE)</span></label><label><input type="radio" autocomplete="off" name="radio_ANLROQIPIH" value=""> <span>sapply(coli_genomes,log10(mean), na.rm=TRUE)</span></label><label><input type="radio" autocomplete="off" name="radio_ANLROQIPIH" value="answer"> <span>None of the previous</span></label>
</div>
<p>Yes, a function must be suitable for the selected data and the dataframe <em>coli_genomes</em> contains numeric and categorical variables, but the function <em>log10(mean)</em> only can work with numeric data. Let’s do it in two steps:</p>
<strong>How would you select only numeric columns?</strong>
<div id="radio_WZXCFPRFUS" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_WZXCFPRFUS" value=""> <span>apply(coli_genomes, 2, is.numeric) </span></label><label><input type="radio" autocomplete="off" name="radio_WZXCFPRFUS" value=""> <span>coli_genomes[lapply(coli_genomes, is.numeric)]</span></label><label><input type="radio" autocomplete="off" name="radio_WZXCFPRFUS" value="answer"> <span>coli_genomes[sapply(coli_genomes, is.numeric)]</span></label><label><input type="radio" autocomplete="off" name="radio_WZXCFPRFUS" value=""> <span>sapply(coli_genomes, is.numeric)</span></label><label><input type="radio" autocomplete="off" name="radio_WZXCFPRFUS" value=""> <span>lapply(coli_genomes, is.numeric)</span></label>
</div>
<strong>How would you obtain log10 of the mean of all the numeric columns?</strong>
<div id="radio_SRDTEBVQUW" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_SRDTEBVQUW" value=""> <span>apply(coli_genomes[sapply(coli_genomes, is.numeric)],2,function(x)log(mean(x))) </span></label><label><input type="radio" autocomplete="off" name="radio_SRDTEBVQUW" value=""> <span>apply(coli_genomes[sapply(coli_genomes, is.numeric)],2,log(mean)) </span></label><label><input type="radio" autocomplete="off" name="radio_SRDTEBVQUW" value=""> <span>apply(coli_genomes[sapply(coli_genomes, is.numeric)],2,fun(x) log(mean), na.rm=TRUE)</span></label><label><input type="radio" autocomplete="off" name="radio_SRDTEBVQUW" value="answer"> <span>apply(coli_genomes[sapply(coli_genomes, is.numeric)],2,function(x)log(mean(x, na.rm=TRUE)))</span></label>
</div>
</section>
</section>
</section>
<section id="sec-references" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> References</h1>
<ol type="1">
<li><p>Manipulación de datos en R: <a href="https://r-coder.com/manipulacion-datos-r/" class="uri">https://r-coder.com/manipulacion-datos-r/</a> [ES] &amp; <a href="https://r-coder.com/r-data-manipulation/" class="uri">https://r-coder.com/r-data-manipulation/</a> [EN]</p></li>
<li><p><em>R in action.</em> Robert I. Kabacoff. March 2022 ISBN 9781617296055</p></li>
<li><p>Working with tables in R: <a href="https://bookdown.org/kdonovan125/ibis_data_analysis_r4/working-with-tables-in-r.html" class="uri">https://bookdown.org/kdonovan125/ibis_data_analysis_r4/working-with-tables-in-r.html</a></p></li>
<li><p>About flat tables in R: <a href="https://cran.r-project.org/web/packages/memisc/vignettes/ftable-matrix.html" class="uri">https://cran.r-project.org/web/packages/memisc/vignettes/ftable-matrix.html</a></p></li>
<li><p><em>data.table</em> cheatsheet: <a href="https://raw.githubusercontent.com/rstudio/cheatsheets/main/datatable.pdf" class="uri">https://raw.githubusercontent.com/rstudio/cheatsheets/main/datatable.pdf</a></p></li>
<li><p>Data aggregation: <a href="https://r-coder.com/aggregate-r/" class="uri">https://r-coder.com/aggregate-r/</a></p></li>
<li><p>About <em>Applies</em>: <a href="https://www.r-bloggers.com/2016/03/apply-lapply-rapply-sapply-functions-in-r-2/" class="uri">https://www.r-bloggers.com/2016/03/apply-lapply-rapply-sapply-functions-in-r-2/</a> &amp; <a href="https://gist.github.com/lyndametref/4d137fcba1ec4d9af80ad53245b358ff" class="uri">https://gist.github.com/lyndametref/4d137fcba1ec4d9af80ad53245b358ff</a></p></li>
<li><p>Efficient data management in R: <a href="https://www.mzes.uni-mannheim.de/socialsciencedatalab/article/efficient-data-r/" class="uri">https://www.mzes.uni-mannheim.de/socialsciencedatalab/article/efficient-data-r/</a></p></li>
</ol>
</section>
<section id="exercises" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> <span style="color:green">Exercises</span></h1>
<p>We are using the Covid19 test data for exercises. You can download the updated <em>csv</em> file from <a href="https://opendata.ecdc.europa.eu/covid19/testing/csv/data.csv" class="uri">https://opendata.ecdc.europa.eu/covid19/testing/csv/data.csv</a> (see also <a href="https://www.ecdc.europa.eu/en/publications-data/covid-19-testing" class="uri">https://www.ecdc.europa.eu/en/publications-data/covid-19-testing</a>). Read and explore the data. I also suggest to save the table in your computer as <em>covid_tests.csv</em>.</p>
<section id="generate-two-contingency-tables-showing-the-number-of-tests-done-1-by-country-per-week-and-2-by-country-per-month." class="level4">
<h4 class="anchored" data-anchor-id="generate-two-contingency-tables-showing-the-number-of-tests-done-1-by-country-per-week-and-2-by-country-per-month.">1. Generate two contingency tables showing the number of tests done (1) by country per week and (2) by country per month.</h4>
<p>Hint. For the second table, use the function <em>ISOweek2date()</em> from the package “ISOweek” to transform the ISO date_week to standard date format.</p>
</section>
<section id="remove-all-the-character-columns-to-create-a-subset-dataframe-named-minitests.-you-can-use-subset-and-sapply-here." class="level4">
<h4 class="anchored" data-anchor-id="remove-all-the-character-columns-to-create-a-subset-dataframe-named-minitests.-you-can-use-subset-and-sapply-here.">2. Remove all the character columns to create a subset dataframe named <em>minitests</em>. You can use <code>subset()</code> and <code>sapply()</code> here.</h4>
</section>
<section id="use-apply-to-obtain-the-min-max-median-and-mean-of-each-column." class="level4">
<h4 class="anchored" data-anchor-id="use-apply-to-obtain-the-min-max-median-and-mean-of-each-column.">3. Use apply() to obtain the min, max, median and mean of each column.</h4>
</section>
<section id="use-tapply-to-obtain-the-mean-median-and-min-of-new_cases-per-country-and-construct-a-dataframe-with-the-result." class="level4">
<h4 class="anchored" data-anchor-id="use-tapply-to-obtain-the-mean-median-and-min-of-new_cases-per-country-and-construct-a-dataframe-with-the-result.">5. Use <code>tapply()</code> to obtain the mean, median and min of new_cases per country and construct a dataframe with the result.</h4>
<p>Hint. Consider how to handle NA’s.</p>
</section>
</section>
<section id="extra-exercises" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> <span style="color:green">Extra exercises</span></h1>
<p>The topics in this lesson can be dense and bewildering the first time. I selected some sheets of exercises from great websites that can give you an extra practice.</p>
<ul>
<li><p><a href="https://www.r-exercises.com/2016/04/14/merging-dataframes-exercises/" class="uri">https://www.r-exercises.com/2016/04/14/merging-dataframes-exercises/</a></p></li>
<li><p><a href="https://www.r-bloggers.com/2016/05/cross-tabulation-with-xtabs-exercises/" class="uri">https://www.r-bloggers.com/2016/05/cross-tabulation-with-xtabs-exercises/</a></p></li>
<li><p><a href="https://www.r-exercises.com/2016/09/08/efficient-processing-with-apply-exercises/" class="uri">https://www.r-exercises.com/2016/09/08/efficient-processing-with-apply-exercises/</a></p></li>
<li><p><a href="https://www.r-exercises.com/2016/06/16/summary-statistics-with-aggregate/" class="uri">https://www.r-exercises.com/2016/06/16/summary-statistics-with-aggregate/</a></p></li>
</ul>
</section>
<section id="session-info" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> Session Info</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb213"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb213-1"><a href="#cb213-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R version 4.4.1 (2024-06-14)
Platform: x86_64-apple-darwin20
Running under: macOS Sonoma 14.6.1

Matrix products: default
BLAS:   /Library/Frameworks/R.framework/Versions/4.4-x86_64/Resources/lib/libRblas.0.dylib 
LAPACK: /Library/Frameworks/R.framework/Versions/4.4-x86_64/Resources/lib/libRlapack.dylib;  LAPACK version 3.12.0

locale:
[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8

time zone: Europe/Madrid
tzcode source: internal

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
[1] data.table_1.16.2  webexercises_1.1.0 formatR_1.14       knitr_1.48        

loaded via a namespace (and not attached):
 [1] digest_0.6.37     fastmap_1.2.0     xfun_0.48         htmltools_0.5.8.1
 [5] rmarkdown_2.28    cli_3.6.3         compiler_4.4.1    rstudioapi_0.17.1
 [9] tools_4.4.1       evaluate_1.0.1    yaml_2.3.10       rlang_1.1.4      
[13] jsonlite_1.8.9    htmlwidgets_1.6.4</code></pre>
</div>
</div>


</section>

<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a></main> <!-- /main -->
<script>

/* update total correct if #webex-total_correct exists */
update_total_correct = function() {
  console.log("webex: update total_correct");

  var t = document.getElementsByClassName("webex-total_correct");
  for (var i = 0; i < t.length; i++) {
    p = t[i].parentElement;
    var correct = p.getElementsByClassName("webex-correct").length;
    var solvemes = p.getElementsByClassName("webex-solveme").length;
    var radiogroups = p.getElementsByClassName("webex-radiogroup").length;
    var selects = p.getElementsByClassName("webex-select").length;

    t[i].innerHTML = correct + " of " + (solvemes + radiogroups + selects) + " correct";
  }
}

/* webex-solution button toggling function */
b_func = function() {
  console.log("webex: toggle hide");

  var cl = this.parentElement.classList;
  if (cl.contains('open')) {
    cl.remove("open");
  } else {
    cl.add("open");
  }
}

/* check answers */
check_func = function() {
  console.log("webex: check answers");

  var cl = this.parentElement.classList;
  if (cl.contains('unchecked')) {
    cl.remove("unchecked");
    this.innerHTML = "Hide Answers";
  } else {
    cl.add("unchecked");
    this.innerHTML = "Show Answers";
  }
}

/* function for checking solveme answers */
solveme_func = function(e) {
  console.log("webex: check solveme");

  var real_answers = JSON.parse(this.dataset.answer);
  var my_answer = this.value;
  var cl = this.classList;
  if (cl.contains("ignorecase")) {
    my_answer = my_answer.toLowerCase();
  }
  if (cl.contains("nospaces")) {
    my_answer = my_answer.replace(/ /g, "")
  }

  if (my_answer == "") {
    cl.remove("webex-correct");
    cl.remove("webex-incorrect");
  } else if (real_answers.includes(my_answer)) {
    cl.add("webex-correct");
    cl.remove("webex-incorrect");
  } else {
    cl.add("webex-incorrect");
    cl.remove("webex-correct");
  }

  // match numeric answers within a specified tolerance
  if(this.dataset.tol > 0){
    var tol = JSON.parse(this.dataset.tol);
    var matches = real_answers.map(x => Math.abs(x - my_answer) < tol)
    if (matches.reduce((a, b) => a + b, 0) > 0) {
      cl.add("webex-correct");
    } else {
      cl.remove("webex-correct");
    }
  }

  // added regex bit
  if (cl.contains("regex")){
    answer_regex = RegExp(real_answers.join("|"))
    if (answer_regex.test(my_answer)) {
      cl.add("webex-correct");
    }
  }

  update_total_correct();
}

/* function for checking select answers */
select_func = function(e) {
  console.log("webex: check select");

  var cl = this.classList

  /* add style */
  cl.remove("webex-incorrect");
  cl.remove("webex-correct");
  if (this.value == "answer") {
    cl.add("webex-correct");
  } else if (this.value != "blank") {
    cl.add("webex-incorrect");
  }

  update_total_correct();
}

/* function for checking radiogroups answers */
radiogroups_func = function(e) {
  console.log("webex: check radiogroups");

  var checked_button = document.querySelector('input[name=' + this.id + ']:checked');
  var cl = checked_button.parentElement.classList;
  var labels = checked_button.parentElement.parentElement.children;

  /* get rid of styles */
  for (i = 0; i < labels.length; i++) {
    labels[i].classList.remove("webex-incorrect");
    labels[i].classList.remove("webex-correct");
  }

  /* add style */
  if (checked_button.value == "answer") {
    cl.add("webex-correct");
  } else {
    cl.add("webex-incorrect");
  }

  update_total_correct();
}

window.onload = function() {
  console.log("webex onload");
  /* set up solution buttons */
  var buttons = document.getElementsByTagName("button");

  for (var i = 0; i < buttons.length; i++) {
    if (buttons[i].parentElement.classList.contains('webex-solution')) {
      buttons[i].onclick = b_func;
    }
  }

  var check_sections = document.getElementsByClassName("webex-check");
  console.log("check:", check_sections.length);
  for (var i = 0; i < check_sections.length; i++) {
    check_sections[i].classList.add("unchecked");

    let btn = document.createElement("button");
    btn.innerHTML = "Show Answers";
    btn.classList.add("webex-check-button");
    btn.onclick = check_func;
    check_sections[i].appendChild(btn);

    let spn = document.createElement("span");
    spn.classList.add("webex-total_correct");
    check_sections[i].appendChild(spn);
  }

  /* set up webex-solveme inputs */
  var solveme = document.getElementsByClassName("webex-solveme");

  for (var i = 0; i < solveme.length; i++) {
    /* make sure input boxes don't auto-anything */
    solveme[i].setAttribute("autocomplete","off");
    solveme[i].setAttribute("autocorrect", "off");
    solveme[i].setAttribute("autocapitalize", "off");
    solveme[i].setAttribute("spellcheck", "false");
    solveme[i].value = "";

    /* adjust answer for ignorecase or nospaces */
    var cl = solveme[i].classList;
    var real_answer = solveme[i].dataset.answer;
    if (cl.contains("ignorecase")) {
      real_answer = real_answer.toLowerCase();
    }
    if (cl.contains("nospaces")) {
      real_answer = real_answer.replace(/ /g, "");
    }
    solveme[i].dataset.answer = real_answer;

    /* attach checking function */
    solveme[i].onkeyup = solveme_func;
    solveme[i].onchange = solveme_func;

    solveme[i].insertAdjacentHTML("afterend", " <span class='webex-icon'></span>")
  }

  /* set up radiogroups */
  var radiogroups = document.getElementsByClassName("webex-radiogroup");
  for (var i = 0; i < radiogroups.length; i++) {
    radiogroups[i].onchange = radiogroups_func;
  }

  /* set up selects */
  var selects = document.getElementsByClassName("webex-select");
  for (var i = 0; i < selects.length; i++) {
    selects[i].onchange = select_func;
    selects[i].insertAdjacentHTML("afterend", " <span class='webex-icon'></span>")
  }

  update_total_correct();
}

</script>
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
          // target, if specified
          link.setAttribute("target", "_blank");
          if (link.getAttribute("rel") === null) {
            link.setAttribute("rel", "noopener");
          }
          // default icon
          link.classList.add("external");
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Modesto Redrejo Rodríguez &amp; Luis del Peso, 2024</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://creativecommons.org/licenses/by-nc/2.0/">
      <i class="bi bi-badge-cc-fill" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/mredrejo">
      <i class="bi bi-twitter" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




<script src="site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>